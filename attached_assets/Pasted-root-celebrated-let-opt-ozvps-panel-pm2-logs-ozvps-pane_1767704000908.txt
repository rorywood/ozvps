root@celebrated-let:/opt/ozvps-panel# pm2 logs ozvps-panel --lines 50
[TAILING] Tailing last 50 lines for [ozvps-panel] process (change the value with --lines option)
/root/.pm2/logs/ozvps-panel-out.log last 50 lines:
0|ozvps-pa | > NODE_ENV=production node dist/index.cjs
0|ozvps-pa |
0|ozvps-pa |
0|ozvps-pa | > rest-express@1.0.0 start
0|ozvps-pa | > NODE_ENV=production node dist/index.cjs
0|ozvps-pa |
0|ozvps-pa |
0|ozvps-pa | > rest-express@1.0.0 start
0|ozvps-pa | > NODE_ENV=production node dist/index.cjs
0|ozvps-pa |
0|ozvps-pa |
0|ozvps-pa | > rest-express@1.0.0 start
0|ozvps-pa | > NODE_ENV=production node dist/index.cjs
0|ozvps-pa |
0|ozvps-pa |
0|ozvps-pa | > rest-express@1.0.0 start
0|ozvps-pa | > NODE_ENV=production node dist/index.cjs
0|ozvps-pa |
0|ozvps-pa |
0|ozvps-pa | > rest-express@1.0.0 start
0|ozvps-pa | > NODE_ENV=production node dist/index.cjs
0|ozvps-pa |
0|ozvps-pa |
0|ozvps-pa | > rest-express@1.0.0 start
0|ozvps-pa | > NODE_ENV=production node dist/index.cjs
0|ozvps-pa |
0|ozvps-pa |
0|ozvps-pa | > rest-express@1.0.0 start
0|ozvps-pa | > NODE_ENV=production node dist/index.cjs
0|ozvps-pa |
0|ozvps-pa |
0|ozvps-pa | > rest-express@1.0.0 start
0|ozvps-pa | > NODE_ENV=production node dist/index.cjs
0|ozvps-pa |
0|ozvps-pa |
0|ozvps-pa | > rest-express@1.0.0 start
0|ozvps-pa | > NODE_ENV=production node dist/index.cjs
0|ozvps-pa |
0|ozvps-pa |
0|ozvps-pa | > rest-express@1.0.0 start
0|ozvps-pa | > NODE_ENV=production node dist/index.cjs
0|ozvps-pa |
0|ozvps-pa |
0|ozvps-pa | > rest-express@1.0.0 start
0|ozvps-pa | > NODE_ENV=production node dist/index.cjs
0|ozvps-pa |
0|ozvps-pa |
0|ozvps-pa | > rest-express@1.0.0 start
0|ozvps-pa | > NODE_ENV=production node dist/index.cjs
0|ozvps-pa |

/root/.pm2/logs/ozvps-panel-error.log last 50 lines:
0|ozvps-pa | estArgs=r,this.spec=n,this.stripeResource=i}async turnPage(){let e=await this.nextPageUrl;if(!e)return null;this.spec.fullPath=e;let r=await this.stripeResource._makeRequest([],this.spec,{});return this.nextPageUrl=Promise.resolve(r.next_page_url),this.currentPageIterator=Promise.resolve(r.data[Symbol.iterator]()),this.currentPageIterator}async next(){{let n=(await this.currentPageIterator).next();if(!n.done)return{done:!1,value:n.value}}let e=await this.turnPage();if(!e)return{done:!0,value:void 0};let r=e.next();return r.done?{done:!0,value:void 0}:{done:!1,value:r.value}}},g4=(t,e,r,n)=>{let i=rs(r.fullPath||r.path);return i!=="v2"&&r.methodType==="search"?qv(new Dv(n,e,r,t)):i!=="v2"&&r.methodType==="list"?qv(new Mv(n,e,r,t)):i==="v2"&&r.methodType==="list"?qv(new $v(n,e,r,t)):null},qv=t=>{let e=kB((...i)=>t.next(...i)),r=AB(e),n={autoPagingEach:e,autoPagingToArray:r,next:()=>t.next(),return:()=>({}),[_B()]:()=>n};return n};function _B(){return typeof Symbol<"u"&&Symbol.asyncIterator?Symbol.asyncIterator:"@@asyncIterator"}function TB(t){if(t.length<2)return null;let e=t[1];if(typeof e!="function")throw Error(`The second argument to autoPagingEach, if present, must be a callback function; received ${typeof e}`);return e}function EB(t){if(t.length===0)return;let e=t[0];if(typeof e!="function")throw Error(`The first argument to autoPagingEach, if present, must be a callback function; received ${typeof e}`);if(e.length===2)return e;if(e.length>2)throw Error(`The \`onItem\` callback function passed to autoPagingEach must accept at most two arguments; got ${e}`);return function(n,i){let s=e(n);i(s)}}function PB(t,e){let r=e?0:t.data.length-1,n=t.data[r],i=n&&n.id;if(!i)throw Error("Unexpected: No `id` found on the last item while auto-paging a list.");return i}function kB(t){return function(){let r=[].slice.call(arguments),n=EB(r),i=TB(r);if(r.length>2)throw Error(`autoPagingEach takes up to two arguments; received ${r}`);let s=CB(t,n);return to(s,i)}}function AB(t){return function(r,n){let i=r&&r.limit;if(!i)throw Error("You must pass a `limit` option to autoPagingToArray, e.g., `autoPagingToArray({limit: 1000});`.");if(i>1e4)throw Error("You cannot specify a limit of more than 10,000 items to fetch in `autoPagingToArray`; use `autoPagingEach` to iterate through longer lists.");let s=new Promise((a,o)=>{let u=[];t(c=>{if(u.push(c),u.length>=i)return!1}).then(()=>{a(u)}).catch(o)});return to(s,n)}}function CB(t,e){return new Promise((r,n)=>{function i(s){if(s.done){r();return}let a=s.value;return new Promise(o=>{e(a,o)}).then(o=>o===!1?i({done:!0,value:void 0}):t().then(i))}t().then(i).catch(n)})}function y4(t){let e=[].slice.call(t);return!!ts(e).ending_before}function x4(t){if(t.path!==void 0&&t.fullPath!==void 0)throw new Error(`Method spec specified both a 'path' (${t.path}) and a 'fullPath' (${t.fullPath}).`);return function(...e){let r=typeof e[e.length-1]=="function"&&e.pop();t.urlParams=a4(t.fullPath||this.createResourcePathWithSymbols(t.path||""));let n=to(this._makeRequest(e,t,{}),r);return Object.assign(n,g4(this,e,t,n)),n}}f.extend=o4;f.method=x4;f.MAX_BUFFERED_REQUEST_METRICS=100;function f(t,e){if(this._stripe=t,e)throw new Error("Support for curried url params was dropped in stripe-node v7.0.0. Instead, pass two ids.");this.basePath=rl(this.basePath||t.getApiField("basePath")),this.resourcePath=this.path,this.path=rl(this.path),this.initialize(...arguments)}f.prototype={_stripe:null,path:"",resourcePath:"",basePath:null,initialize(){},requestDataProcessor:null,validateRequest:null,createFullPath(t,e){let r=[this.basePath(e),this.path(e)];if(typeof t=="function"){let n=t(e);n&&r.push(n)}else r.push(t);return this._joinUrlParts(r)},createResourcePathWithSymbols(t){return t?`/${this._joinUrlParts([this.resourcePath,t])}`:`/${this.resourcePath}`},_joinUrlParts(t){return t.join("/").replace(/\/{2,}/g,"/")},_getRequestOpts(t,e,r){var n;let i=(e.method||"GET").toUpperCase(),s=e.usage||[],a=e.urlParams||[],o=e.encode||(I=>I),u=!!e.fullPath,c=rl(u?e.fullPath:e.path||""),l=u?e.fullPath:this.createResourcePathWithSymbols(e.path),p=[].slice.call(t),d=a.reduce((I,M)=>{let z=p.shift();if(typeof z!="string")throw new Error(`Stripe: Argument "${M}" must be a string, but got: ${z} (on API request to \`${i} ${l}\`)`);return I[M]=z,I},{}),m=ts(p),h=o(Object.assign({},m,r)),v=nl(p),w=v.host||e.host,S=!!e.streaming||!!v.streaming;if(p.filter(I=>I!=null).length)throw new Error(`Stripe: Unknown arguments (${p}). Did you mean to pass an options object? See https://github.com/stripe/stripe-node/wiki/Passing-Options. (on API request to ${i} \`${l}\`)`);let E=u?c(d):this.createFullPath(c,d),T=Object.assign(v.headers,e.headers);e.validator&&e.validator(h,{headers:T});let k=e.method==="GET"||e.method==="DELETE";return{requestMethod:i,requestPath:E,bodyData:k?null:h,queryData:k?h:{},authenticator:(n=v.authenticator)!==null&&n!==void 0?n:null,headers:T,host:w??null,streaming:S,settings:v.settings,usage:s}},_makeRequest(t,e,r){return new Promise((n,i)=>{var s;let a;try{a=this._getRequestOpts(t,e,r)}catch(d){i(d);return}function o(d,m){d?i(d):n(e.transformResponseData?e.transformResponseData(m):m)}let u=Object.keys(a.queryData).length===0,c=[a.requestPath,u?"":"?",Zr(a.queryData,rs(a.requestPath))].join(""),{headers:l,settings:p}=a;this._stripe._requestSender._request(a.requestMethod,a.host,c,a.bodyData,a.authenticator,{headers:l,settings:p,streaming:a.streaming},a.usage,o,(s=this.requestDataProcessor)===null||s===void 0?void 0:s.bind(this))})}};var oo=class t{constructor(e=[]){this._segments=[...e]}get segments(){return[...this._segments]}push(e){if(!e)throw new Error("Segment cannot be null or undefined");return new t([...this._segments,e])}pop(){if(this._segments.length===0)throw new Error("Cannot pop from an empty context");return new t(this._segments.slice(0,-1))}toString(){return this._segments.join("/")}static parse(e){return e?new t(e.split("/")):new t([])}};function b4(t){let e={DEFAULT_TOLERANCE:300,signature:null,constructEvent(l,p,d,m,h,v){try{if(!this.signature)throw new Error("ERR: missing signature helper, unable to verify");this.signature.verifyHeader(l,p,d,m||e.DEFAULT_TOLERANCE,h,v)}catch(S){throw S instanceof es&&(S.message+="\nUse `await constructEventAsync(...)` instead of `constructEvent(...)`"),S}return l instanceof Uint8Array?JSON.parse(new TextDecoder("utf8").decode(l)):JSON.parse(l)},async constructEventAsync(l,p,d,m,h,v){if(!this.signature)throw new Error("ERR: missing signature helper, unable to verify");return await this.signature.verifyHeaderAsync(l,p,d,m||e.DEFAULT_TOLERANCE,h,v),l instanceof Uint8Array?JSON.parse(new TextDecoder("utf8").decode(l)):JSON.parse(l)},generateTestHeaderString:function(l){let p=c(l),d=p.signature||p.cryptoProvider.computeHMACSignature(p.payloadString,p.secret);return p.generateHeaderString(d)},generateTestHeaderStringAsync:async function(l){let p=c(l),d=p.signature||await p.cryptoProvider.computeHMACSignatureAsync(p.payloadString,p.secret);return p.generateHeaderString(d)}},r={EXPECTED_SCHEME:"v1",verifyHeader(l,p,d,m,h,v){let{decodedHeader:w,decodedPayload:S,details:E,suspectPayloadType:T}=i(l,p,this.EXPECTED_SCHEME),k=/\s/.test(d);h=h||u();let D=h.computeHMACSignature(n(S,E),d);return s(S,w,E,D,m,T,k,v),!0},async verifyHeaderAsync(l,p,d,m,h,v){let{decodedHeader:w,decodedPayload:S,details:E,suspectPayloadType:T}=i(l,p,this.EXPECTED_SCHEME),k=/\s/.test(d);h=h||u();let D=await h.computeHMACSignatureAsync(n(S,E),d);return s(S,w,E,D,m,T,k,v)}};function n(l,p){return`${p.timestamp}.${l}`}function i(l,p,d){if(!l)throw new Zt(p,l,{message:"No webhook payload was provided."});let m=typeof l!="string"&&!(l instanceof Uint8Array),h=new TextDecoder("utf8"),v=l instanceof Uint8Array?h.decode(l):l;if(Array.isArray(p))throw new Error("Unexpected: An array was passed as a header, which should not be possible for the stripe-signature header.");if(p==null||p=="")throw new Zt(p,l,{message:"No stripe-signature header value was provided."});let w=p instanceof Uint8Array?h.decode(p):p,S=a(w,d);if(!S||S.timestamp===-1)throw new Zt(w,v,{message:"Unable to extract timestamp and signatures from header"});if(!S.signatures.length)throw new Zt(w,v,{message:"No signatures found with expected scheme"});return{decodedPayload:v,decodedHeader:w,details:S,suspectPayloadType:m}}function s(l,p,d,m,h,v,w,S){let E=!!d.signatures.filter(t.secureCompare.bind(t,m)).length,T=`
0|ozvps-pa |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
0|ozvps-pa |
0|ozvps-pa | Error: DATABASE_URL environment variable is not set
0|ozvps-pa |     at Object.<anonymous> (/opt/ozvps-panel/dist/index.cjs:70:43696)
0|ozvps-pa |     at Module._compile (node:internal/modules/cjs/loader:1521:14)
0|ozvps-pa |     at Module._extensions..js (node:internal/modules/cjs/loader:1623:10)
0|ozvps-pa |     at Module.load (node:internal/modules/cjs/loader:1266:32)
0|ozvps-pa |     at Module._load (node:internal/modules/cjs/loader:1091:12)
0|ozvps-pa |     at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:164:12)
0|ozvps-pa |     at node:internal/main/run_main_module:28:49
0|ozvps-pa |
0|ozvps-pa | Node.js v20.19.6

0|ozvps-panel  | > rest-express@1.0.0 start
0|ozvps-panel  | > NODE_ENV=production node dist/index.cjs
0|ozvps-panel  | /opt/ozvps-panel/dist/index.cjs:70
0|ozvps-panel  |                `;await r.execute(b`CREATE SCHEMA IF NOT EXISTS ${b.identifier(s)}`),await r.execute(a);let u=(await r.all(b`select id, hash, created_at from ${b.identifier(s)}.${b.identifier(i)} order by created_at desc limit 1`))[0];await r.transaction(async c=>{for await(let l of e)if(!u||Number(u.created_at)<l.folderMillis){for(let p of l.sql)await c.execute(b.raw(p));await c.execute(b`insert into ${b.identifier(s)}.${b.identifier(i)} ("hash", "created_at") values(${l.hash}, ${l.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let r=[b`with `];for(let[n,i]of e.entries())r.push(b`${b.identifier(i._.alias)} as (${i._.sql})`),n<e.length-1&&r.push(b`, `);return r.push(b` `),b.join(r)}buildDeleteQuery({table:e,where:r,returning:n,withList:i}){let s=this.buildWithCTE(i),a=n?b` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,o=r?b` where ${r}`:void 0;return b`${s}delete from ${e}${o}${a}`}buildUpdateSet(e,r){let n=e[O.Symbol.Columns],i=Object.keys(n).filter(a=>r[a]!==void 0||n[a]?.onUpdateFn!==void 0),s=i.length;return b.join(i.flatMap((a,o)=>{let u=n[a],c=r[a]??b.param(u.onUpdateFn(),u),l=b`${b.identifier(this.casing.getColumnCasing(u))} = ${c}`;return o<s-1?[l,b.raw(", ")]:[l]}))}buildUpdateQuery({table:e,set:r,where:n,returning:i,withList:s,from:a,joins:o}){let u=this.buildWithCTE(s),c=e[Ge.Symbol.Name],l=e[Ge.Symbol.Schema],p=e[Ge.Symbol.OriginalName],d=c===p?void 0:c,m=b`${l?b`${b.identifier(l)}.`:void 0}${b.identifier(p)}${d&&b` ${b.identifier(d)}`}`,h=this.buildUpdateSet(e,r),v=a&&b.join([b.raw(" from "),this.buildFromTable(a)]),w=this.buildJoins(o),S=i?b` returning ${this.buildSelection(i,{isSingleTable:!a})}`:void 0,E=n?b` where ${n}`:void 0;return b`${u}update ${m} set ${h}${v}${w}${E}${S}`}buildSelection(e,{isSingleTable:r=!1}={}){let n=e.length,i=e.flatMap(({field:s},a)=>{let o=[];if(_(s,N.Aliased)&&s.isSelectionField)o.push(b.identifier(s.fieldAlias));else if(_(s,N.Aliased)||_(s,N)){let u=_(s,N.Aliased)?s.sql:s;r?o.push(new N(u.queryChunks.map(c=>_(c,A)?b.identifier(this.casing.getColumnCasing(c)):c))):o.push(u),_(s,N.Aliased)&&o.push(b` as ${b.identifier(s.fieldAlias)}`)}else _(s,Y)&&(r?o.push(b.identifier(this.casing.getColumnCasing(s))):o.push(s));return a<n-1&&o.push(b`, `),o});return b.join(i)}buildJoins(e){if(!e||e.length===0)return;let r=[];for(let[n,i]of e.entries()){n===0&&r.push(b` `);let s=i.table,a=i.lateral?b` lateral`:void 0;if(_(s,Ge)){let o=s[Ge.Symbol.Name],u=s[Ge.Symbol.Schema],c=s[Ge.Symbol.OriginalName],l=o===c?void 0:i.alias;r.push(b`${b.raw(i.joinType)} join${a} ${u?b`${b.identifier(u)}.`:void 0}${b.identifier(c)}${l&&b` ${b.identifier(l)}`} on ${i.on}`)}else if(_(s,pt)){let o=s[de].name,u=s[de].schema,c=s[de].originalName,l=o===c?void 0:i.alias;r.push(b`${b.raw(i.joinType)} join${a} ${u?b`${b.identifier(u)}.`:void 0}${b.identifier(c)}${l&&b` ${b.identifier(l)}`} on ${i.on}`)}else r.push(b`${b.raw(i.joinType)} join${a} ${s} on ${i.on}`);n<e.length-1&&r.push(b` `)}return b.join(r)}buildFromTable(e){if(_(e,O)&&e[O.Symbol.OriginalName]!==e[O.Symbol.Name]){let r=b`${b.identifier(e[O.Symbol.OriginalName])}`;return e[O.Symbol.Schema]&&(r=b`${b.identifier(e[O.Symbol.Schema])}.${r}`),b`${r} ${b.identifier(e[O.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:r,fieldsFlat:n,where:i,having:s,table:a,joins:o,orderBy:u,groupBy:c,limit:l,offset:p,lockingClause:d,distinct:m,setOperators:h}){let v=n??Dt(r);for(let ee of v)if(_(ee.field,Y)&&wt(ee.field.table)!==(_(a,je)?a._.alias:_(a,Li)?a[de].name:_(a,N)?void 0:wt(a))&&!(Me=>o?.some(({alias:mr})=>mr===(Me[O.Symbol.IsAlias]?wt(Me):Me[O.Symbol.BaseName])))(ee.field.table)){let Me=wt(ee.field.table);throw new Error(`Your "${ee.path.join("->")}" field references a column "${Me}"."${ee.field.name}", but the table "${Me}" is not part of the query! Did you forget to join it?`)}let w=!o||o.length===0,S=this.buildWithCTE(e),E;m&&(E=m===!0?b` distinct`:b` distinct on (${b.join(m.on,b`, `)})`);let T=this.buildSelection(v,{isSingleTable:w}),k=this.buildFromTable(a),D=this.buildJoins(o),F=i?b` where ${i}`:void 0,I=s?b` having ${s}`:void 0,M;u&&u.length>0&&(M=b` order by ${b.join(u,b`, `)}`);let z;c&&c.length>0&&(z=b` group by ${b.join(c,b`, `)}`);let ae=typeof l=="object"||typeof l=="number"&&l>=0?b` limit ${l}`:void 0,Ze=p?b` offset ${p}`:void 0,et=b.empty();if(d){let ee=b` for ${b.raw(d.strength)}`;d.config.of&&ee.append(b` of ${b.join(Array.isArray(d.config.of)?d.config.of:[d.config.of],b`, `)}`),d.config.noWait?ee.append(b` no wait`):d.config.skipLocked&&ee.append(b` skip locked`),et.append(ee)}let fe=b`${S}select${E} ${T} from ${k}${D}${F}${z}${I}${M}${ae}${Ze}${et}`;return h.length>0?this.buildSetOperations(fe,h):fe}buildSetOperations(e,r){let[n,...i]=r;if(!n)throw new Error("Cannot pass undefined values to any set operator");return i.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:n}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:n}),i)}buildSetOperationQuery({leftSelect:e,setOperator:{type:r,isAll:n,rightSelect:i,limit:s,orderBy:a,offset:o}}){let u=b`(${e.getSQL()}) `,c=b`(${i.getSQL()})`,l;if(a&&a.length>0){let h=[];for(let v of a)if(_(v,A))h.push(b.identifier(v.name));else if(_(v,N)){for(let w=0;w<v.queryChunks.length;w++){let S=v.queryChunks[w];_(S,A)&&(v.queryChunks[w]=b.identifier(S.name))}h.push(b`${v}`)}else h.push(b`${v}`);l=b` order by ${b.join(h,b`, `)} `}let p=typeof s=="object"||typeof s=="number"&&s>=0?b` limit ${s}`:void 0,d=b.raw(`${r} ${n?"all ":""}`),m=o?b` offset ${o}`:void 0;return b`${u}${d}${c}${l}${p}${m}`}buildInsertQuery({table:e,values:r,onConflict:n,returning:i,withList:s,select:a,overridingSystemValue_:o}){let u=[],c=e[O.Symbol.Columns],l=Object.entries(c).filter(([S,E])=>!E.shouldDisableInsert()),p=l.map(([,S])=>b.identifier(this.casing.getColumnCasing(S)));if(a){let S=r;_(S,N)?u.push(S):u.push(S.getSQL())}else{let S=r;u.push(b.raw("values "));for(let[E,T]of S.entries()){let k=[];for(let[D,F]of l){let I=T[D];if(I===void 0||_(I,St)&&I.value===void 0)if(F.defaultFn!==void 0){let M=F.defaultFn(),z=_(M,N)?M:b.param(M,F);k.push(z)}else if(!F.default&&F.onUpdateFn!==void 0){let M=F.onUpdateFn(),z=_(M,N)?M:b.param(M,F);k.push(z)}else k.push(b`default`);else k.push(I)}u.push(k),E<S.length-1&&u.push(b`, `)}}let d=this.buildWithCTE(s),m=b.join(u),h=i?b` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,v=n?b` on conflict ${n}`:void 0,w=o===!0?b`overriding system value `:void 0;return b`${d}insert into ${e} ${p} ${w}${m}${v}${h}`}buildRefreshMaterializedViewQuery({view:e,concurrently:r,withNoData:n}){let i=r?b` concurrently`:void 0,s=n?b` with no data`:void 0;return b`refresh materialized view${i} ${e}${s}`}prepareTyping(e){return _(e,Ca)||_(e,Aa)?"json":_(e,Oa)?"decimal":_(e,Ia)?"time":_(e,Ra)||_(e,Na)?"timestamp":_(e,Pa)||_(e,ka)?"date":_(e,ja)?"uuid":"none"}sqlToQuery(e,r){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:r})}buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:i,tableConfig:s,queryConfig:a,tableAlias:o,nestedQueryRelation:u,joinOn:c}){let l=[],p,d,m=[],h,v=[];if(a===!0)l=Object.entries(s.columns).map(([E,T])=>({dbKey:T.name,tsKey:E,field:ur(T,o),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let S=Object.fromEntries(Object.entries(s.columns).map(([I,M])=>[I,ur(M,o)]));if(a.where){let I=typeof a.where=="function"?a.where(S,eE()):a.where;h=I&&_a(I,o)}let E=[],T=[];if(a.columns){let I=!1;for(let[M,z]of Object.entries(a.columns))z!==void 0&&M in s.columns&&(!I&&z===!0&&(I=!0),T.push(M));T.length>0&&(T=I?T.filter(M=>a.columns?.[M]===!0):Object.keys(s.columns).filter(M=>!T.includes(M)))}else T=Object.keys(s.columns);for(let I of T){let M=s.columns[I];E.push({tsKey:I,value:M})}let k=[];a.with&&(k=Object.entries(a.with).filter(I=>!!I[1]).map(([I,M])=>({tsKey:I,queryConfig:M,relation:s.relations[I]})));let D;if(a.extras){D=typeof a.extras=="function"?a.extras(S,{sql:b}):a.extras;for(let[I,M]of Object.entries(D))E.push({tsKey:I,value:zf(M,o)})}for(let{tsKey:I,value:M}of E)l.push({dbKey:_(M,N.Aliased)?M.fieldAlias:s.columns[I].name,tsKey:I,field:_(M,Y)?ur(M,o):M,relationTableTsKey:void 0,isJson:!1,selection:[]});let F=typeof a.orderBy=="function"?a.orderBy(S,tE()):a.orderBy??[];Array.isArray(F)||(F=[F]),m=F.map(I=>_(I,Y)?ur(I,o):_a(I,o)),p=a.limit,d=a.offset;for(let{tsKey:I,queryConfig:M,relation:z}of k){let ae=nE(r,n,z),Ze=$n(z.referencedTable),et=n[Ze],fe=`${o}_${I}`,ee=Da(...ae.fields.map((xs,Hl)=>Se(ur(ae.references[Hl],fe),ur(xs,o)))),Me=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:e[et],tableConfig:r[et],queryConfig:_(z,Ur)?M===!0?{limit:1}:{...M,limit:1}:M,tableAlias:fe,joinOn:ee,nestedQueryRelation:z}),mr=b`${b.identifier(fe)}.${b.identifier("data")}`.as(I);v.push({on:b`true`,table:new je(Me.sql,{},fe),alias:fe,joinType:"left",lateral:!0}),l.push({dbKey:I,tsKey:I,field:mr,relationTableTsKey:et,isJson:!0,selection:Me.selection})}}if(l.length===0)throw new Ma({message:`No fields selected for table "${s.tsName}" ("${o}")`});let w;if(h=Da(c,h),u){let S=b`json_build_array(${b.join(l.map(({field:k,tsKey:D,isJson:F})=>F?b`${b.identifier(`${o}_${D}`)}.${b.identifier("data")}`:_(k,N.Aliased)?k.sql:k),b`, `)})`;_(u,Fa)&&(S=b`coalesce(json_agg(${S}${m.length>0?b` order by ${b.join(m,b`, `)}`:void 0}), '[]'::json)`);let E=[{dbKey:"data",tsKey:"data",field:S.as("data"),isJson:!0,relationTableTsKey:s.tsName,selection:l}];p!==void 0||d!==void 0||m.length>0?(w=this.buildSelectQuery({table:Sa(i,o),fields:{},fieldsFlat:[{path:[],field:b.raw("*")}],where:h,limit:p,offset:d,orderBy:m,setOperators:[]}),h=void 0,p=void 0,d=void 0,m=[]):w=Sa(i,o),w=this.buildSelectQuery({table:_(w,Ge)?w:new je(w,{},o),fields:{},fieldsFlat:E.map(({field:k})=>({path:[],field:_(k,Y)?ur(k,o):k})),joins:v,where:h,limit:p,offset:d,orderBy:m,setOperators:[]})}else w=this.buildSelectQuery({table:Sa(i,o),fields:{},fieldsFlat:l.map(({field:S})=>({path:[],field:_(S,Y)?ur(S,o):S})),joins:v,where:h,limit:p,offset:d,orderBy:m,setOperators:[]});return{tableTsKey:s.tsName,sql:w,selection:l}}};var _u=class{static[g]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var st=class{static[g]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let r=!!this.fields,n=e,i;return this.fields?i=this.fields:_(n,je)?i=Object.fromEntries(Object.keys(n._.selectedFields).map(s=>[s,n[s]])):_(n,Li)?i=n[de].selectedFields:_(n,N)?i={}:i=fu(n),new Tu({table:n,fields:i,isPartialSelect:r,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},ch=class extends _u{static[g]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:r,isPartialSelect:n,session:i,dialect:s,withList:a,distinct:o}){super(),this.config={withList:a,table:e,fields:{...r},distinct:o,setOperators:[]},this.isPartialSelect=n,this.session=i,this.dialect=s,this._={selectedFields:r},this.tableName=_r(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(r,n)=>{let i=this.tableName,s=_r(r);if(typeof s=="string"&&this.config.joins?.some(a=>a.alias===s))throw new Error(`Alias "${s}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof i=="string"&&(this.config.fields={[i]:this.config.fields}),typeof s=="string"&&!_(r,N))){let a=_(r,je)?r._.selectedFields:_(r,pt)?r[de].selectedFields:r[O.Symbol.Columns];this.config.fields[s]=a}if(typeof n=="function"&&(n=n(new Proxy(this.config.fields,new Ce({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:n,table:r,joinType:e,alias:s}),typeof s=="string")switch(e){case"left":{this.joinsNotNullableMap[s]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[s]=!0;break}case"inner":{this.joinsNotNullableMap[s]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[s]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,r){return n=>{let i=typeof n=="function"?n(j$()):n;if(!Ta(this.getSelectedFields(),i.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:r,rightSelect:i}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Ce({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Ce({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new Ce({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(r)?r:[r]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new Ce({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),n=Array.isArray(r)?r:[r];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=n:this.config.orderBy=n}else{let r=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,r={}){return this.config.lockingClause={strength:e,config:r},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}as(e){return new Proxy(new je(this.getSQL(),this.config.fields,e),new Ce({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new Ce({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},Tu=class extends ch{static[g]="PgSelect";_prepare(e){let{session:r,config:n,dialect:i,joinsNotNullableMap:s,authToken:a}=this;if(!r)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return pe.startActiveSpan("drizzle.prepareQuery",()=>{let o=Dt(n.fields),u=r.prepareQuery(i.sqlToQuery(this.getSQL()),o,e,!0);return u.joinsNotNullableMap=s,u.setToken(a)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>pe.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};rT(Tu,[it]);function Bi(t,e){return(r,n,...i)=>{let s=[n,...i].map(a=>({type:t,isAll:e,rightSelect:a}));for(let a of s)if(!Ta(r.getSelectedFields(),a.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return r.addSetOperators(s)}}var j$=()=>({union:q$,unionAll:M$,intersect:D$,intersectAll:$$,except:F$,exceptAll:L$}),q$=Bi("union",!1),M$=Bi("union",!0),D$=Bi("intersect",!1),$$=Bi("intersect",!0),F$=Bi("except",!1),L$=Bi("except",!0);var Ui=class{static[g]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=_(e,zr)?e:void 0,this.dialectConfig=_(e,zr)?void 0:e}$with=(e,r)=>{let n=this;return{as:s=>(typeof s=="function"&&(s=s(n)),new Proxy(new $i(s.getSQL(),r??("getSelectedFields"in s?s.getSelectedFields()??{}:{}),e,!0),new Ce({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let r=this;function n(a){return new st({fields:a??void 0,session:void 0,dialect:r.getDialect(),withList:e})}function i(a){return new st({fields:a??void 0,session:void 0,dialect:r.getDialect(),distinct:!0})}function s(a,o){return new st({fields:o??void 0,session:void 0,dialect:r.getDialect(),distinct:{on:a}})}return{select:n,selectDistinct:i,selectDistinctOn:s}}select(e){return new st({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new st({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,r){return new st({fields:r??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new zr(this.dialectConfig)),this.dialect}};var La=class{constructor(e,r,n,i,s){this.table=e,this.session=r,this.dialect=n,this.withList=i,this.overridingSystemValue_=s}static[g]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let r=e.map(n=>{let i={},s=this.table[O.Symbol.Columns];for(let a of Object.keys(n)){let o=n[a];i[a]=_(o,N)?o:new St(o,s[a])}return i});return new Eu(this.table,r,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let r=typeof e=="function"?e(new Ui):e;if(!_(r,N)&&!Ta(this.table[pu],r._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new Eu(this.table,r,this.session,this.dialect,this.withList,!0)}},Eu=class extends it{constructor(e,r,n,i,s,a,o){super(),this.session=n,this.dialect=i,this.config={table:e,values:r,withList:s,select:a,overridingSystemValue_:o}}static[g]="PgInsert";config;returning(e=this.config.table[O.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=Dt(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=b`do nothing`;else{let r="";r=Array.isArray(e.target)?e.target.map(i=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(i))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let n=e.where?b` where ${e.where}`:void 0;this.config.onConflict=b`(${b.raw(r)})${n} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let r=e.where?b` where ${e.where}`:void 0,n=e.targetWhere?b` where ${e.targetWhere}`:void 0,i=e.setWhere?b` where ${e.setWhere}`:void 0,s=this.dialect.buildUpdateSet(this.config.table,du(this.config.table,e.set)),a="";return a=Array.isArray(e.target)?e.target.map(o=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(o))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=b`(${b.raw(a)})${n} do update set ${s}${r}${i}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return pe.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>pe.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Ce({alias:wt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var Pu=class extends it{constructor(e,r,n){super(),this.session=r,this.dialect=n,this.config={view:e}}static[g]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return pe.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>pe.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};var Ba=class{constructor(e,r,n,i){this.table=e,this.session=r,this.dialect=n,this.withList=i}static[g]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new uh(this.table,du(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},uh=class extends it{constructor(e,r,n,i,s){super(),this.session=n,this.dialect=i,this.config={set:r,table:e,withList:s,joins:[]},this.tableName=_r(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[g]="PgUpdate";config;tableName;joinsNotNullableMap;from(e){let r=e,n=_r(r);return typeof n=="string"&&(this.joinsNotNullableMap[n]=!0),this.config.from=r,this}getTableLikeFields(e){return _(e,Ge)?e[O.Symbol.Columns]:_(e,je)?e._.selectedFields:e[de].selectedFields}createJoin(e){return(r,n)=>{let i=_r(r);if(typeof i=="string"&&this.config.joins.some(s=>s.alias===i))throw new Error(`Alias "${i}" is already used in this query`);if(typeof n=="function"){let s=this.config.from&&!_(this.config.from,N)?this.getTableLikeFields(this.config.from):void 0;n=n(new Proxy(this.config.table[O.Symbol.Columns],new Ce({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),s&&new Proxy(s,new Ce({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:n,table:r,joinType:e,alias:i}),typeof i=="string")switch(e){case"left":{this.joinsNotNullableMap[i]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[i]=!0;break}case"inner":{this.joinsNotNullableMap[i]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[i]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[O.Symbol.Columns]),this.config.from)){let r=_r(this.config.from);if(typeof r=="string"&&this.config.from&&!_(this.config.from,N)){let n=this.getTableLikeFields(this.config.from);e[r]=n}for(let n of this.config.joins){let i=_r(n.table);if(typeof i=="string"&&!_(n.table,N)){let s=this.getTableLikeFields(n.table);e[i]=s}}}return this.config.returningFields=e,this.config.returning=Dt(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){let r=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0);return r.joinsNotNullableMap=this.joinsNotNullableMap,r}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Ce({alias:wt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var ku=class t extends N{constructor(e){super(t.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=t.buildCount(e.source,e.filters)}sql;token;static[g]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,r){return b`(select count(*) from ${e}${b.raw(" where ").if(r)}${r})`}static buildCount(e,r){return b`select count(*) as count from ${e}${b.raw(" where ").if(r)}${r};`}setToken(e){return this.token=e,this}then(e,r){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,r)}catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}};var Au=class{constructor(e,r,n,i,s,a,o){this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=s,this.dialect=a,this.session=o}static[g]="PgRelationalQueryBuilder";findMany(e){return new Cu(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new Cu(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},Cu=class extends it{constructor(e,r,n,i,s,a,o,u,c){super(),this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=s,this.dialect=a,this.session=o,this.config=u,this.mode=c}static[g]="PgRelationalQuery";_prepare(e){return pe.startActiveSpan("drizzle.prepareQuery",()=>{let{query:r,builtQuery:n}=this._toSQL();return this.session.prepareQuery(n,void 0,e,!0,(i,s)=>{let a=i.map(o=>wu(this.schema,this.tableConfig,o,r.selection,s));return this.mode==="first"?a[0]:a})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),r=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:r}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return pe.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};var Ou=class extends it{constructor(e,r,n,i){super(),this.execute=e,this.sql=r,this.query=n,this.mapBatchResult=i}static[g]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,r){return r?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var zi=class{constructor(e,r,n){if(this.dialect=e,this.session=r,this._=n?{schema:n.schema,fullSchema:n.fullSchema,tableNamesMap:n.tableNamesMap,session:r}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:r},this.query={},this._.schema)for(let[i,s]of Object.entries(this._.schema))this.query[i]=new Au(n.fullSchema,this._.schema,this._.tableNamesMap,n.fullSchema[i],s,e,r)}static[g]="PgDatabase";query;$with=(e,r)=>{let n=this;return{as:s=>(typeof s=="function"&&(s=s(new Ui(n.dialect))),new Proxy(new $i(s.getSQL(),r??("getSelectedFields"in s?s.getSelectedFields()??{}:{}),e,!0),new Ce({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,r){return new ku({source:e,filters:r,session:this.session})}with(...e){let r=this;function n(c){return new st({fields:c??void 0,session:r.session,dialect:r.dialect,withList:e})}function i(c){return new st({fields:c??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:!0})}function s(c,l){return new st({fields:l??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:{on:c}})}function a(c){return new Ba(c,r.session,r.dialect,e)}function o(c){return new La(c,r.session,r.dialect,e)}function u(c){return new qa(c,r.session,r.dialect,e)}return{select:n,selectDistinct:i,selectDistinctOn:s,update:a,insert:o,delete:u}}select(e){return new st({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new st({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,r){return new st({fields:r??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new Ba(e,this.session,this.dialect)}insert(e){return new La(e,this.session,this.dialect)}delete(e){return new qa(e,this.session,this.dialect)}refreshMaterializedView(e){return new Pu(e,this.session,this.dialect)}authToken;execute(e){let r=typeof e=="string"?b.raw(e):e.getSQL(),n=this.dialect.sqlToQuery(r),i=this.session.prepareQuery(n,void 0,void 0,!1);return new Ou(()=>i.execute(void 0,this.authToken),r,n,s=>i.mapResult(s,!0))}transaction(e,r){return this.session.transaction(e,r)}};var Iu=class{constructor(e){this.query=e}authToken;getQuery(){return this.query}mapResult(e,r){return e}setToken(e){return this.authToken=e,this}static[g]="PgPreparedQuery";joinsNotNullableMap},Ru=class{constructor(e){this.dialect=e}static[g]="PgSession";execute(e,r){return pe.startActiveSpan("drizzle.operation",()=>pe.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(r).execute(void 0,r))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,r){let n=await this.execute(e,r);return Number(n[0].count)}},Nu=class extends zi{constructor(e,r,n,i=0){super(e,r,n),this.schema=n,this.nestedIndex=i}static[g]="PgTransaction";rollback(){throw new gu}getTransactionConfigSQL(e){let r=[];return e.isolationLevel&&r.push(`isolation level ${e.isolationLevel}`),e.accessMode&&r.push(e.accessMode),typeof e.deferrable=="boolean"&&r.push(e.deferrable?"deferrable":"not deferrable"),b.raw(r.join(" "))}setTransaction(e){return this.session.execute(b`set transaction ${this.getTransactionConfigSQL(e)}`)}};var lh=class{static[g]="ConsoleLogWriter";write(e){console.log(e)}},ju=class{static[g]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new lh}logQuery(e,r){let n=r.map(s=>{try{return JSON.stringify(s)}catch{return String(s)}}),i=n.length?` -- params: [${n.join(", ")}]`:"";this.writer.write(`Query: ${e}${i}`)}},qu=class{static[g]="NoopLogger";logQuery(){}};var _e={INT8_MIN:-128,INT8_MAX:127,INT8_UNSIGNED_MAX:255,INT16_MIN:-32768,INT16_MAX:32767,INT16_UNSIGNED_MAX:65535,INT24_MIN:-8388608,INT24_MAX:8388607,INT24_UNSIGNED_MAX:16777215,INT32_MIN:-2147483648,INT32_MAX:2147483647,INT32_UNSIGNED_MAX:4294967295,INT48_MIN:-0x800000000000,INT48_MAX:0x7fffffffffff,INT48_UNSIGNED_MAX:0xffffffffffff,INT64_MIN:-9223372036854775808n,INT64_MAX:9223372036854775807n,INT64_UNSIGNED_MAX:18446744073709551615n};function Re(t,e){return e.includes(t.columnType)}function B$(t){return"enumValues"in t&&Array.isArray(t.enumValues)&&t.enumValues.length>0}var U$=H.union([H.string(),H.number(),H.boolean(),H.null()]),z$=H.union([U$,H.record(H.any()),H.array(H.any())]),G$=H.custom(t=>t instanceof Buffer);function sE(t,e){let r=e?.zodInstance??H,n=e?.coerce??{},i;return B$(t)&&(i=t.enumValues.length?r.enum(t.enumValues):r.string()),i||(Re(t,["PgGeometry","PgPointTuple"])?i=r.tuple([r.number(),r.number()]):Re(t,["PgGeometryObject","PgPointObject"])?i=r.object({x:r.number(),y:r.number()}):Re(t,["PgHalfVector","PgVector"])?(i=r.array(r.number()),i=t.dimensions?i.length(t.dimensions):i):Re(t,["PgLine"])?i=r.tuple([r.number(),r.number(),r.number()]):Re(t,["PgLineABC"])?i=r.object({a:r.number(),b:r.number(),c:r.number()}):Re(t,["PgArray"])?(i=r.array(sE(t.baseColumn,r)),i=t.size?i.length(t.size):i):t.dataType==="array"?i=r.array(r.any()):t.dataType==="number"?i=H$(t,r,n):t.dataType==="bigint"?i=V$(t,r,n):t.dataType==="boolean"?i=n===!0||n.boolean?r.coerce.boolean():r.boolean():t.dataType==="date"?i=n===!0||n.date?r.coerce.date():r.date():t.dataType==="string"?i=Q$(t,r,n):t.dataType==="json"?i=z$:t.dataType==="custom"?i=r.any():t.dataType==="buffer"&&(i=G$)),i||(i=r.any()),i}function H$(t,e,r){let n=t.getSQLType().includes("unsigned"),i,s,a=!1;Re(t,["MySqlTinyInt","SingleStoreTinyInt"])?(i=n?0:_e.INT8_MIN,s=n?_e.INT8_UNSIGNED_MAX:_e.INT8_MAX,a=!0):Re(t,["PgSmallInt","PgSmallSerial","MySqlSmallInt","SingleStoreSmallInt"])?(i=n?0:_e.INT16_MIN,s=n?_e.INT16_UNSIGNED_MAX:_e.INT16_MAX,a=!0):Re(t,["PgReal","MySqlFloat","MySqlMediumInt","SingleStoreMediumInt","SingleStoreFloat"])?(i=n?0:_e.INT24_MIN,s=n?_e.INT24_UNSIGNED_MAX:_e.INT24_MAX,a=Re(t,["MySqlMediumInt","SingleStoreMediumInt"])):Re(t,["PgInteger","PgSerial","MySqlInt","SingleStoreInt"])?(i=n?0:_e.INT32_MIN,s=n?_e.INT32_UNSIGNED_MAX:_e.INT32_MAX,a=!0):Re(t,["PgDoublePrecision","MySqlReal","MySqlDouble","SingleStoreReal","SingleStoreDouble","SQLiteReal"])?(i=n?0:_e.INT48_MIN,s=n?_e.INT48_UNSIGNED_MAX:_e.INT48_MAX):Re(t,["PgBigInt53","PgBigSerial53","MySqlBigInt53","MySqlSerial","SingleStoreBigInt53","SingleStoreSerial","SQLiteInteger"])?(n=n||Re(t,["MySqlSerial","SingleStoreSerial"]),i=n?0:Number.MIN_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER,a=!0):Re(t,["MySqlYear","SingleStoreYear"])?(i=1901,s=2155,a=!0):(i=Number.MIN_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER);let o=r===!0||r?.number?e.coerce.number():e.number();return o=o.min(i).max(s),a?o.int():o}function V$(t,e,r){let n=t.getSQLType().includes("unsigned"),i=n?0n:_e.INT64_MIN,s=n?_e.INT64_UNSIGNED_MAX:_e.INT64_MAX;return(r===!0||r?.bigint?e.coerce.bigint():e.bigint()).min(i).max(s)}function Q$(t,e,r){if(Re(t,["PgUUID"]))return e.string().uuid();let n,i,s=!1;Re(t,["PgVarchar","SQLiteText"])?n=t.length:Re(t,["MySqlVarChar","SingleStoreVarChar"])?n=t.length??_e.INT16_UNSIGNED_MAX:Re(t,["MySqlText","SingleStoreText"])&&(t.textType==="longtext"?n=_e.INT32_UNSIGNED_MAX:t.textType==="mediumtext"?n=_e.INT24_UNSIGNED_MAX:t.textType==="text"?n=_e.INT16_UNSIGNED_MAX:n=_e.INT8_UNSIGNED_MAX),Re(t,["PgChar","MySqlChar","SingleStoreChar"])&&(n=t.length,s=!0),Re(t,["PgBinaryVector"])&&(i=/^[01]+$/,n=t.dimensions);let a=r===!0||r?.string?e.coerce.string():e.string();return a=i?a.regex(i):a,n&&s?a.length(n):n?a.max(n):a}function aE(t){return Lf(t)?fu(t):nT(t)}function oE(t,e,r,n){let i={};for(let[s,a]of Object.entries(t)){if(!_(a,Y)&&!_(a,N)&&!_(a,N.Aliased)&&typeof a=="object"){let p=Lf(a)||Y_(a)?aE(a):a;i[s]=oE(p,e[s]??{},r,n);continue}let o=e[s];if(o!==void 0&&typeof o!="function"){i[s]=o;continue}let u=_(a,Y)?a:void 0,c=u?sE(u,n):H.any(),l=typeof o=="function"?o(c):c;r.never(u)||(i[s]=l,u&&(r.nullable(u)&&(i[s]=i[s].nullable()),r.optional(u)&&(i[s]=i[s].optional())))}return H.object(i)}var W$={never:t=>t?.generated?.type==="always"||t?.generatedIdentity?.type==="always",optional:t=>!t.notNull||t.notNull&&t.hasDefault,nullable:t=>!t.notNull};var Ua=(t,e)=>{let r=aE(t);return oE(r,e??{},W$)};var K$=Er("user_mappings",{id:ge("id").primaryKey().generatedAlwaysAsIdentity(),auth0UserId:Z("auth0_user_id").notNull().unique(),email:Z("email").notNull(),name:Z("name"),virtFusionUserId:ge("virtfusion_user_id").notNull(),createdAt:nt("created_at").defaultNow().notNull()}),Z$=Er("users",{id:ge("id").primaryKey().generatedAlwaysAsIdentity(),email:Z("email").notNull().unique(),passwordHash:Z("password_hash").notNull(),name:Z("name"),virtFusionUserId:ge("virtfusion_user_id"),extRelationId:Z("ext_relation_id"),status:Z("status").notNull().default("active"),createdAt:nt("created_at").defaultNow().notNull()}),J$=Er("sessions",{id:hu("id",{length:64}).primaryKey(),userId:ge("user_id"),auth0UserId:Z("auth0_user_id"),virtFusionUserId:ge("virtfusion_user_id"),extRelationId:Z("ext_relation_id"),email:Z("email").notNull(),name:Z("name"),expiresAt:nt("expires_at").notNull(),createdAt:nt("created_at").defaultNow().notNull(),revokedAt:nt("revoked_at"),revokedReason:Z("revoked_reason")}),X$=Er("user_flags",{id:ge("id").primaryKey().generatedAlwaysAsIdentity(),auth0UserId:Z("auth0_user_id").notNull().unique(),blocked:Ea("blocked").default(!1).notNull(),blockedReason:Z("blocked_reason"),blockedAt:nt("blocked_at"),updatedAt:nt("updated_at").defaultNow().notNull()}),He=Er("plans",{id:ge("id").primaryKey().generatedAlwaysAsIdentity(),code:Z("code").notNull().unique(),name:Z("name").notNull(),vcpu:ge("vcpu").notNull(),ramMb:ge("ram_mb").notNu
0|ozvps-panel  | ll(),storageGb:ge("storage_gb").notNull(),transferGb:ge("transfer_gb").notNull(),priceMonthly:ge("price_monthly_cents").notNull(),virtfusionPackageId:ge("virtfusion_package_id"),active:Ea("active").default(!0).notNull(),createdAt:nt("created_at").defaultNow().notNull()}),ye=Er("wallets",{id:ge("id").primaryKey().generatedAlwaysAsIdentity(),auth0UserId:Z("auth0_user_id").notNull().unique(),stripeCustomerId:Z("stripe_customer_id").unique(),balanceCents:ge("balance_cents").notNull().default(0),createdAt:nt("created_at").defaultNow().notNull(),updatedAt:nt("updated_at").defaultNow().notNull()}),dt=Er("wallet_transactions",{id:ge("id").primaryKey().generatedAlwaysAsIdentity(),auth0UserId:Z("auth0_user_id").notNull(),type:Z("type").notNull(),amountCents:ge("amount_cents").notNull(),stripeEventId:Z("stripe_event_id").unique(),stripePaymentIntentId:Z("stripe_payment_intent_id"),stripeSessionId:Z("stripe_session_id"),metadata:mu("metadata"),createdAt:nt("created_at").defaultNow().notNull()}),kt=Er("deploy_orders",{id:ge("id").primaryKey().generatedAlwaysAsIdentity(),auth0UserId:Z("auth0_user_id").notNull(),planId:ge("plan_id").notNull(),locationCode:Z("location_code").notNull().default("BNE"),hostname:Z("hostname"),priceCents:ge("price_cents").notNull(),status:Z("status").notNull().default("pending_payment"),virtfusionServerId:ge("virtfusion_server_id"),errorMessage:Z("error_message"),createdAt:nt("created_at").defaultNow().notNull(),updatedAt:nt("updated_at").defaultNow().notNull()}),Y$=Su(ye,({many:t})=>({transactions:t(dt)})),e9=Su(dt,({one:t})=>({wallet:t(ye,{fields:[dt.auth0UserId],references:[ye.auth0UserId]})})),t9=Su(kt,({one:t})=>({plan:t(He,{fields:[kt.planId],references:[He.id]})})),r9=Ua(He).omit({id:!0,createdAt:!0}),n9=Ua(ye).omit({id:!0,createdAt:!0,updatedAt:!0}),i9=Ua(dt).omit({id:!0,createdAt:!0}),s9=Ua(kt).omit({id:!0,createdAt:!0,updatedAt:!0}),ph=H.object({email:H.string().email(),password:H.string().min(1)}),dh=H.object({email:H.string().email(),password:H.string().min(8,"Password must be at least 8 characters"),name:H.string().min(1,"Name is required").optional()}),fh=H.object({name:H.string().min(2,"Server name must be at least 2 characters").max(48,"Server name must be 48 characters or less").regex(/^[a-zA-Z0-9][a-zA-Z0-9\s\-_.]*$/,"Server name can only contain letters, numbers, spaces, hyphens, underscores, and periods")}),cE=H.string().min(1,"Hostname is required").max(63,"Hostname must be 63 characters or less").regex(/^[a-z0-9]([a-z0-9-]*[a-z0-9])?$/,"Hostname must be lowercase, start and end with a letter or number, and contain only letters, numbers, and hyphens").transform(t=>t.toLowerCase().trim()),mh=H.object({osId:H.union([H.string(),H.number()]).refine(t=>t!==""&&t!==null,"OS template is required"),hostname:cE}),Pr={CONCURRENT_LOGIN:"CONCURRENT_LOGIN",USER_BLOCKED:"USER_BLOCKED",ADMIN_REVOKED:"ADMIN_REVOKED",PASSWORD_CHANGED:"PASSWORD_CHANGED",IDLE_TIMEOUT:"IDLE_TIMEOUT",ALREADY_LOGGED_IN:"ALREADY_LOGGED_IN"};var At=Je(hv(),1),kX=At.default.Client,AX=At.default.Pool,CX=At.default.Connection,OX=At.default.types,IX=At.default.Query,RX=At.default.DatabaseError,NX=At.default.escapeIdentifier,jX=At.default.escapeLiteral,qX=At.default.Result,MX=At.default.TypeOverrides,DX=At.default.defaults,Qr=At.default;var{Pool:ZP,types:pr}=Qr,xv=class extends Iu{constructor(e,r,n,i,s,a,o,u){super({sql:r,params:n}),this.client=e,this.params=n,this.logger=i,this.fields=s,this._isResponseInArrayMode=o,this.customResultMapper=u,this.rawQueryConfig={name:a,text:r,types:{getTypeParser:(c,l)=>c===pr.builtins.TIMESTAMPTZ?p=>p:c===pr.builtins.TIMESTAMP?p=>p:c===pr.builtins.DATE?p=>p:c===pr.builtins.INTERVAL?p=>p:pr.getTypeParser(c,l)}},this.queryConfig={name:a,text:r,rowMode:"array",types:{getTypeParser:(c,l)=>c===pr.builtins.TIMESTAMPTZ?p=>p:c===pr.builtins.TIMESTAMP?p=>p:c===pr.builtins.DATE?p=>p:c===pr.builtins.INTERVAL?p=>p:pr.getTypeParser(c,l)}}}static[g]="NodePgPreparedQuery";rawQueryConfig;queryConfig;async execute(e={}){return pe.startActiveSpan("drizzle.execute",async()=>{let r=Uf(this.params,e);this.logger.logQuery(this.rawQueryConfig.text,r);let{fields:n,rawQueryConfig:i,client:s,queryConfig:a,joinsNotNullableMap:o,customResultMapper:u}=this;if(!n&&!u)return pe.startActiveSpan("drizzle.driver.execute",async l=>(l?.setAttributes({"drizzle.query.name":i.name,"drizzle.query.text":i.text,"drizzle.query.params":JSON.stringify(r)}),s.query(i,r)));let c=await pe.startActiveSpan("drizzle.driver.execute",l=>(l?.setAttributes({"drizzle.query.name":a.name,"drizzle.query.text":a.text,"drizzle.query.params":JSON.stringify(r)}),s.query(a,r)));return pe.startActiveSpan("drizzle.mapResponse",()=>u?u(c.rows):c.rows.map(l=>tT(n,l,o)))})}all(e={}){return pe.startActiveSpan("drizzle.execute",()=>{let r=Uf(this.params,e);return this.logger.logQuery(this.rawQueryConfig.text,r),pe.startActiveSpan("drizzle.driver.execute",n=>(n?.setAttributes({"drizzle.query.name":this.rawQueryConfig.name,"drizzle.query.text":this.rawQueryConfig.text,"drizzle.query.params":JSON.stringify(r)}),this.client.query(this.rawQueryConfig,r).then(i=>i.rows)))})}isResponseInArrayMode(){return this._isResponseInArrayMode}},Ju=class t extends Ru{constructor(e,r,n,i={}){super(r),this.client=e,this.schema=n,this.options=i,this.logger=i.logger??new qu}static[g]="NodePgSession";logger;prepareQuery(e,r,n,i,s){return new xv(this.client,e.sql,e.params,this.logger,r,n,i,s)}async transaction(e,r){let n=this.client instanceof ZP?new t(await this.client.connect(),this.dialect,this.schema,this.options):this,i=new bv(this.dialect,n,this.schema);await i.execute(b`begin${r?b` ${i.getTransactionConfigSQL(r)}`:void 0}`);try{let s=await e(i);return await i.execute(b`commit`),s}catch(s){throw await i.execute(b`rollback`),s}finally{this.client instanceof ZP&&n.client.release()}}async count(e){let r=await this.execute(e);return Number(r.rows[0].count)}},bv=class t extends Nu{static[g]="NodePgTransaction";async transaction(e){let r=`sp${this.nestedIndex+1}`,n=new t(this.dialect,this.session,this.schema,this.nestedIndex+1);await n.execute(b.raw(`savepoint ${r}`));try{let i=await e(n);return await n.execute(b.raw(`release savepoint ${r}`)),i}catch(i){throw await n.execute(b.raw(`rollback to savepoint ${r}`)),i}}};var wv=class{constructor(e,r,n={}){this.client=e,this.dialect=r,this.options=n}static[g]="NodePgDriver";createSession(e){return new Ju(this.client,this.dialect,e,{logger:this.options.logger})}},Sv=class extends zi{static[g]="NodePgDatabase"};function Ya(t,e={}){let r=new zr({casing:e.casing}),n;e.logger===!0?n=new ju:e.logger!==!1&&(n=e.logger);let i;if(e.schema){let u=rE(e.schema,iE);i={fullSchema:e.schema,schema:u.tables,tableNamesMap:u.tableNamesMap}}let a=new wv(t,r,{logger:n}).createSession(i),o=new Sv(r,a,i);return o.$client=t,o}function Xu(...t){if(typeof t[0]=="string"){let e=new Qr.Pool({connectionString:t[0]});return Ya(e,t[1])}if(iT(t[0])){let{connection:e,client:r,...n}=t[0];if(r)return Ya(r,n);let i=typeof e=="string"?new Qr.Pool({connectionString:e}):new Qr.Pool(e);return Ya(i,n)}return Ya(t[0],t[1])}(t=>{function e(r){return Ya({},r)}t.mock=e})(Xu||(Xu={}));if(!process.env.DATABASE_URL)throw new Error("DATABASE_URL environment variable is not set");var mB=new Qr.Pool({connectionString:process.env.DATABASE_URL}),ve=Xu(mB,{schema:hh});var _v=class{sessions=new Map;userFlagsMap=new Map;async createSession(e){let r=(0,JP.randomBytes)(32).toString("hex"),n=new Date,i={id:r,userId:e.visitorId||null,auth0UserId:e.auth0UserId||null,virtFusionUserId:e.virtFusionUserId||null,extRelationId:e.extRelationId||null,email:e.email,name:e.name||null,expiresAt:e.expiresAt,revokedAt:null,revokedReason:null,lastActivityAt:n};return this.sessions.set(r,i),i}async getSession(e){let r=this.sessions.get(e);if(r){if(new Date(r.expiresAt)<new Date){this.sessions.delete(e);return}return r.revokedAt,r}}async deleteSession(e){this.sessions.delete(e)}async deleteUserSessions(e){let r=[];this.sessions.forEach((n,i)=>{n.userId===e&&r.push(i)}),r.forEach(n=>this.sessions.delete(n))}async deleteSessionsByAuth0UserId(e){let r=[];this.sessions.forEach((n,i)=>{n.auth0UserId===e&&r.push(i)}),r.forEach(n=>this.sessions.delete(n))}async revokeSessionsByAuth0UserId(e,r){this.sessions.forEach(n=>{n.auth0UserId===e&&!n.revokedAt&&(n.revokedAt=new Date,n.revokedReason=r)})}async hasActiveSession(e,r){let n=new Date;for(let i of this.sessions.values())if(i.auth0UserId===e&&!i.revokedAt&&new Date(i.expiresAt)>n){let s=new Date(i.lastActivityAt);if(n.getTime()-s.getTime()<=r)return!0}return!1}async revokeIdleSessions(e,r,n){let i=new Date;this.sessions.forEach(s=>{if(s.auth0UserId===e&&!s.revokedAt&&new Date(s.expiresAt)>i){let a=new Date(s.lastActivityAt);i.getTime()-a.getTime()>r&&(s.revokedAt=i,s.revokedReason=n)}})}async updateSessionActivity(e){let r=this.sessions.get(e);r&&(r.lastActivityAt=new Date)}async getUserFlags(e){return this.userFlagsMap.get(e)}async setUserBlocked(e,r,n){let i=this.userFlagsMap.get(e);i?(i.blocked=r,i.blockedReason=r&&n||null,i.blockedAt=r?new Date:null):this.userFlagsMap.set(e,{auth0UserId:e,blocked:r,blockedReason:r&&n||null,blockedAt:r?new Date:null})}},Qe=new _v,oe={async getActivePlans(){return ve.select().from(He).where(Se(He.active,!0))},async getPlanById(t){let[e]=await ve.select().from(He).where(Se(He.id,t));return e},async getPlanByCode(t){let[e]=await ve.select().from(He).where(Se(He.code,t));return e},async upsertPlan(t){if(t.virtfusionPackageId){let[n]=await ve.select().from(He).where(Se(He.virtfusionPackageId,t.virtfusionPackageId));if(n){let i={...t};t.priceMonthly===0&&n.priceMonthly&&n.priceMonthly>0&&(i.priceMonthly=n.priceMonthly),n.active===!1&&(i.active=!1);let[s]=await ve.update(He).set(i).where(Se(He.virtfusionPackageId,t.virtfusionPackageId)).returning();return s}}let e=await this.getPlanByCode(t.code);if(e){let n={...t};t.priceMonthly===0&&e.priceMonthly&&e.priceMonthly>0&&(n.priceMonthly=e.priceMonthly),e.active===!1&&(n.active=!1);let[i]=await ve.update(He).set(n).where(Se(He.code,t.code)).returning();return i}let[r]=await ve.insert(He).values(t).returning();return r},async syncPlansFromVirtFusion(t){let e=[],r=0;for(let n of t)try{let s=n.prices?.find(a=>a.billingPeriod==="monthly"||a.billingPeriod==="month"||!a.billingPeriod)?.price||0;await this.upsertPlan({code:n.code,name:n.name,vcpu:n.cpuCores,ramMb:n.memory,storageGb:n.primaryStorage,transferGb:n.traffic,priceMonthly:s,virtfusionPackageId:n.id,active:n.enabled}),r++}catch(i){e.push(`Failed to sync package ${n.code}: ${i.message}`)}return{synced:r,errors:e}},async getWallet(t){let[e]=await ve.select().from(ye).where(Se(ye.auth0UserId,t));return e},async getOrCreateWallet(t){let e=await this.getWallet(t);if(e)return e;let[r]=await ve.insert(ye).values({auth0UserId:t,balanceCents:0}).returning();return r},async updateWalletStripeCustomerId(t,e){let[r]=await ve.update(ye).set({stripeCustomerId:e,updatedAt:new Date}).where(Se(ye.auth0UserId,t)).returning();return r},async getWalletByStripeCustomerId(t){let[e]=await ve.select().from(ye).where(Se(ye.stripeCustomerId,t));return e},async creditWallet(t,e,r){if(r.stripeEventId){let[i]=await ve.select().from(dt).where(Se(dt.stripeEventId,r.stripeEventId));if(i)return await this.getOrCreateWallet(t)}await this.getOrCreateWallet(t),await ve.insert(dt).values({auth0UserId:t,amountCents:e,...r});let[n]=await ve.update(ye).set({balanceCents:b`${ye.balanceCents} + ${e}`,updatedAt:new Date}).where(Se(ye.auth0UserId,t)).returning();return n},async debitWallet(t,e,r){if((await this.getOrCreateWallet(t)).balanceCents<e)return{success:!1,error:"Insufficient balance"};await ve.insert(dt).values({auth0UserId:t,type:"debit",amountCents:-e,metadata:r||null});let[i]=await ve.update(ye).set({balanceCents:b`${ye.balanceCents} - ${e}`,updatedAt:new Date}).where(Se(ye.auth0UserId,t)).returning();return{success:!0,wallet:i}},async refundToWallet(t,e,r){await this.getOrCreateWallet(t),await ve.insert(dt).values({auth0UserId:t,type:"refund",amountCents:e,metadata:r||null});let[n]=await ve.update(ye).set({balanceCents:b`${ye.balanceCents} + ${e}`,updatedAt:new Date}).where(Se(ye.auth0UserId,t)).returning();return n},async getWalletTransactions(t,e=50){return ve.select().from(dt).where(Se(dt.auth0UserId,t)).orderBy($a(dt.createdAt)).limit(e)},async createDeployOrder(t){let[e]=await ve.insert(kt).values(t).returning();return e},async getDeployOrder(t){let[e]=await ve.select().from(kt).where(Se(kt.id,t));return e},async getDeployOrdersByUser(t){return ve.select().from(kt).where(Se(kt.auth0UserId,t)).orderBy($a(kt.createdAt))},async updateDeployOrder(t,e){let[r]=await ve.update(kt).set({...e,updatedAt:new Date}).where(Se(kt.id,t)).returning();return r},async createDeployWithDebit(t,e,r,n){if((await this.getOrCreateWallet(t)).balanceCents<r)return{success:!1,error:"Insufficient balance"};let s=await this.createDeployOrder({auth0UserId:t,planId:e,locationCode:"BNE",hostname:n,priceCents:r,status:"paid"});return await ve.insert(dt).values({auth0UserId:t,type:"debit",amountCents:-r,metadata:{deployOrderId:s.id}}),await ve.update(ye).set({balanceCents:b`${ye.balanceCents} - ${r}`,updatedAt:new Date}).where(Se(ye.auth0UserId,t)),{success:!0,order:s}}};var XP=process.env.AUTH0_DOMAIN,Tv=process.env.AUTH0_CLIENT_ID,YP=process.env.AUTH0_CLIENT_SECRET,Ev=class{baseUrl;managementToken=null;managementTokenExpiry=0;constructor(){if(!XP)throw new Error("AUTH0_DOMAIN is not configured");this.baseUrl=`https://${XP}`}async getManagementToken(){if(this.managementToken&&Date.now()<this.managementTokenExpiry)return this.managementToken;let e=await fetch(`${this.baseUrl}/oauth/token`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({grant_type:"client_credentials",client_id:Tv,client_secret:YP,audience:`${this.baseUrl}/api/v2/`})});if(!e.ok){let n=await e.json();throw x(`Failed to get Auth0 management token: ${n.error_description}`,"auth0"),new Error("Failed to get management token")}let r=await e.json();return this.managementToken=r.access_token,this.managementTokenExpiry=Date.now()+(r.expires_in-60)*1e3,this.managementToken}async authenticateUser(e,r){try{let n=await fetch(`${this.baseUrl}/oauth/token`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({grant_type:"password",username:e,password:r,client_id:Tv,client_secret:YP,scope:"openid profile email"})});if(!n.ok){let o=await n.json();return x(`Auth0 login failed for ${e}: ${o.error_description}`,"auth0"),o.error_description?.toLowerCase().includes("block")?{success:!1,error:"Your account has been banned by Support. Please contact us at support@ozvps.com.au for further info."}:o.error==="invalid_grant"?{success:!1,error:"Invalid email or password"}:{success:!1,error:o.error_description||"Authentication failed"}}let i=await n.json(),s=await fetch(`${this.baseUrl}/userinfo`,{headers:{Authorization:`Bearer ${i.access_token}`}});if(!s.ok)return x("Failed to get user info from Auth0","auth0"),{success:!1,error:"Failed to get user information"};let a=await s.json();return{success:!0,user:{user_id:a.sub,email:a.email,name:a.name||a.nickname,email_verified:a.email_verified}}}catch(n){return x(`Auth0 authentication error: ${n.message}`,"auth0"),{success:!1,error:"Authentication service unavailable"}}}async createUser(e,r,n){try{let i=await fetch(`${this.baseUrl}/dbconnections/signup`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:Tv,email:e,password:r,connection:"Username-Password-Authentication",name:n||e.split("@")[0]})});if(!i.ok){let a=await i.json();return x(`Auth0 user creation failed for ${e}: ${JSON.stringify(a)}`,"auth0"),a.code==="invalid_signup"||a.description?.includes("already exists")?{success:!1,error:"An account with this email already exists"}:a.code==="password_strength_error"||a.name==="PasswordStrengthError"?{success:!1,error:"Password is too weak. Please use a stronger password."}:{success:!1,error:a.description||a.message||"Failed to create account"}}let s=await i.json();return{success:!0,user:{user_id:s._id||`auth0|${s._id}`,email:s.email,name:n||e.split("@")[0],email_verified:!1}}}catch(i){return x(`Auth0 user creation error: ${i.message}`,"auth0"),{success:!1,error:"Account creation service unavailable"}}}async getUserByEmail(e){try{let r=await this.getManagementToken(),n=await fetch(`${this.baseUrl}/api/v2/users-by-email?email=${encodeURIComponent(e)}`,{headers:{Authorization:`Bearer ${r}`}});if(!n.ok)return x(`Failed to get Auth0 user by email: ${n.status}`,"auth0"),null;let i=await n.json();if(i.length===0)return null;let s=i[0];return{user_id:s.user_id,email:s.email,name:s.name,email_verified:s.email_verified,app_metadata:s.app_metadata}}catch(r){return x(`Auth0 get user error: ${r.message}`,"auth0"),null}}async getUserById(e){try{let r=await this.getManagementToken(),n=await fetch(`${this.baseUrl}/api/v2/users/${encodeURIComponent(e)}`,{headers:{Authorization:`Bearer ${r}`}});if(!n.ok)return x(`Failed to get Auth0 user by ID: ${n.status}`,"auth0"),null;let i=await n.json();return{user_id:i.user_id,email:i.email,name:i.name,email_verified:i.email_verified,app_metadata:i.app_metadata}}catch(r){return x(`Auth0 get user by ID error: ${r.message}`,"auth0"),null}}async setVirtFusionUserId(e,r){try{let n=await this.getManagementToken(),i=await fetch(`${this.baseUrl}/api/v2/users/${encodeURIComponent(e)}`,{method:"PATCH",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({app_metadata:{virtfusion_user_id:r}})});if(!i.ok){let s=await i.text();return x(`Failed to update Auth0 user metadata: ${i.status} ${s}`,"auth0"),!1}return x(`Stored VirtFusion user ID ${r} in Auth0 metadata for user ${e}`,"auth0"),!0}catch(n){return x(`Auth0 metadata update error: ${n.message}`,"auth0"),!1}}async getVirtFusionUserId(e){return(await this.getUserById(e))?.app_metadata?.virtfusion_user_id||null}async changePassword(e,r){try{let n=await this.getManagementToken(),i=await fetch(`${this.baseUrl}/api/v2/users/${encodeURIComponent(e)}`,{method:"PATCH",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({password:r,connection:"Username-Password-Authentication"})});if(!i.ok){let s=await i.json();return x(`Failed to change Auth0 password: ${i.status} ${JSON.stringify(s)}`,"auth0"),s.message?.includes("PasswordStrengthError")||s.code==="password_strength_error"?{success:!1,error:"Password is too weak. Please use a stronger password with at least 8 characters, including uppercase, lowercase, numbers, and special characters."}:s.message?.includes("PasswordHistoryError")?{success:!1,error:"Cannot reuse a recent password. Please choose a different password."}:{success:!1,error:s.message||"Failed to change password"}}return x(`Password changed successfully for user ${e}`,"auth0"),{success:!0}}catch(n){return x(`Auth0 password change error: ${n.message}`,"auth0"),{success:!1,error:"Password change service unavailable"}}}},Un=new Ev;var e4=["fuck","shit","ass","asshole","bitch","damn","crap","bastard","cunt","dick","cock","pussy","whore","slut","fag","faggot","nigger","nigga","retard","porn","porno","xxx","nsfw","hentai","nude","nudes","naked","sex","sexy","onlyfans","fansly","chaturbate","pornhub","xvideos","xhamster","redtube","youporn","brazzers","shithead","dickhead","asshat","dumbass","jackass","motherfucker","fucker","fucking","fucked","shitting","shitted","bitchy","asses","dicks","cocks","pussies","sluts","whores","cunts"];function hB(t){let e=t.toLowerCase();for(let n of e4)if(e.includes(n))return!0;let r=e.replace(/[\-_.\s]/g,"");for(let n of e4)if(r.includes(n))return!0;return!1}function t4(t){let e=t.trim();return e.length===0?{valid:!1,error:"Server name cannot be empty"}:e.length>48?{valid:!1,error:"Server name must be 48 characters or less"}:e.length<2?{valid:!1,error:"Server name must be at least 2 characters"}:hB(e)?{valid:!1,error:"Server name contains inappropriate content"}:/^[a-zA-Z0-9][a-zA-Z0-9\s\-_.]*$/.test(e)?{valid:!0}:{valid:!1,error:"Server name can only contain letters, numbers, spaces, hyphens, underscores, and periods"}}var as=Je(require("crypto"),1),Nv=require("events");var el=Je(require("crypto"),1);var Wr=class{computeHMACSignature(e,r){throw new Error("computeHMACSignature not implemented.")}computeHMACSignatureAsync(e,r){throw new Error("computeHMACSignatureAsync not implemented.")}computeSHA256Async(e){throw new Error("computeSHA256 not implemented.")}},es=class extends Error{};var Yu=class extends Wr{computeHMACSignature(e,r){return el.createHmac("sha256",r).update(e,"utf8").digest("hex")}async computeHMACSignatureAsync(e,r){return await this.computeHMACSignature(e,r)}async computeSHA256Async(e){return new Uint8Array(await el.createHash("sha256").update(e).digest())}};var kv=Je(require("http"),1),Av=Je(require("https"),1);var Ye=class t{getClientName(){throw new Error("getClientName not implemented.")}makeRequest(e,r,n,i,s,a,o,u){throw new Error("makeRequest not implemented.")}static makeTimeoutError(){let e=new TypeError(t.TIMEOUT_ERROR_CODE);return e.code=t.TIMEOUT_ERROR_CODE,e}};Ye.CONNECTION_CLOSED_ERROR_CODES=["ECONNRESET","EPIPE"];Ye.TIMEOUT_ERROR_CODE="ETIMEDOUT";var Kr=class{constructor(e,r){this._statusCode=e,this._headers=r}getStatusCode(){return this._statusCode}getHeaders(){return this._headers}getRawResponse(){throw new Error("getRawResponse not implemented.")}toStream(e){throw new Error("toStream not implemented.")}toJSON(){throw new Error("toJSON not implemented.")}};var r4=kv.default||kv,n4=Av.default||Av,vB=new r4.Agent({keepAlive:!0}),gB=new n4.Agent({keepAlive:!0}),eo=class extends Ye{constructor(e){super(),this._agent=e}getClientName(){return"node"}makeRequest(e,r,n,i,s,a,o,u){let c=o==="http",l=this._agent;return l||(l=c?vB:gB),new Promise((d,m)=>{let h=(c?r4:n4).request({host:e,port:r,path:n,method:i,agent:l,headers:s,ciphers:"DEFAULT:!aNULL:!eNULL:!LOW:!EXPORT:!SSLv2:!MD5"});h.setTimeout(u,()=>{h.destroy(Ye.makeTimeoutError())}),h.on("response",v=>{d(new Pv(v))}),h.on("error",v=>{m(v)}),h.once("socket",v=>{v.connecting?v.once(c?"connect":"secureConnect",()=>{h.write(a),h.end()}):(h.write(a),h.end())})})}},Pv=class extends Kr{constructor(e){super(e.statusCode,e.headers||{}),this._res=e}getRawResponse(){return this._res}toStream(e){return this._res.once("end",()=>e()),this._res}toJSON(){return new Promise((e,r)=>{let n="";this._res.setEncoding("utf8"),this._res.on("data",i=>{n+=i}),this._res.once("end",()=>{try{e(JSON.parse(n))}catch(i){r(i)}})})}};var i4=Je(Vs(),1),Cv=["apiKey","idempotencyKey","stripeAccount","apiVersion","maxNetworkRetries","timeout","host","authenticator","stripeContext","additionalHeaders","streaming"];function s4(t){return t&&typeof t=="object"&&Cv.some(e=>Object.prototype.hasOwnProperty.call(t,e))}function Zr(t,e){return i4.stringify(t,{serializeDate:r=>Math.floor(r.getTime()/1e3).toString(),arrayFormat:"indices"}).replace(/%5B/g,"[").replace(/%5D/g,"]")}var rl=(()=>{let t={"\n":"\\n",'"':'\\"',"\u2028":"\\u2028","\u2029":"\\u2029"};return e=>{let r=e.replace(/["\n\r\u2028\u2029]/g,n=>t[n]);return n=>r.replace(/\{([\s\S]+?)\}/g,(i,s)=>{let a=n[s];return yB(a)?encodeURIComponent(a):""})}})();function yB(t){return["number","string","boolean"].includes(typeof t)}function a4(t){let e=t.match(/\{\w+\}/g);return e?e.map(r=>r.replace(/[{}]/g,"")):[]}function ts(t){if(!Array.isArray(t)||!t[0]||typeof t[0]!="object")return{};if(!s4(t[0]))return t.shift();let e=Object.keys(t[0]),r=e.filter(n=>Cv.includes(n));return r.length>0&&r.length!==e.length&&ro(`Options found in arguments (${r.join(", ")}). Did you mean to pass an options object? See https://github.com/stripe/stripe-node/wiki/Passing-Options.`),{}}function nl(t){let e={host:null,headers:{},settings:{},streaming:!1};if(t.length>0){let r=t[t.length-1];if(typeof r=="string")e.authenticator=tl(t.pop());else if(s4(r)){let n=Object.assign({},t.pop()),i=Object.keys(n).filter(s=>!Cv.includes(s));if(i.length&&ro(`Invalid options found (${i.join(", ")}); ignoring.`),n.apiKey&&(e.authenticator=tl(n.apiKey)),n.idempotencyKey&&(e.headers["Idempotency-Key"]=n.idempotencyKey),n.stripeAccount&&(e.headers["Stripe-Account"]=n.stripeAccount),n.stripeContext){if(e.headers["Stripe-Account"])throw new Error("Can't specify both stripeAccount and stripeContext.");e.headers["Stripe-Context"]=n.stripeContext}if(n.apiVersion&&(e.headers["Stripe-Version"]=n.apiVersion),Number.isInteger(n.maxNetworkRetries)&&(e.settings.maxNetworkRetries=n.maxNetworkRetries),Number.isInteger(n.timeout)&&(e.settings.timeout=n.timeout),n.host&&(e.host=n.host),n.authenticator){if(n.apiKey)throw new Error("Can't specify both apiKey and authenticator.");if(typeof n.authenticator!="function")throw new Error("The authenticator must be a function receiving a request as the first parameter.");e.authenticator=n.authenticator}n.additionalHeaders&&(e.headers=n.additionalHeaders),n.streaming&&(e.streaming=!0)}}return e}function o4(t){let e=this,r=Object.prototype.hasOwnProperty.call(t,"constructor")?t.constructor:function(...n){e.apply(this,n)};return Object.assign(r,e),r.prototype=Object.create(e.prototype),Object.assign(r.prototype,t),r}function il(t){if(typeof t!="object")throw new Error("Argument must be an object");return Object.keys(t).reduce((e,r)=>(t[r]!=null&&(e[r]=t[r]),e),{})}function c4(t){return t&&typeof t=="object"?Object.keys(t).reduce((e,r)=>(e[xB(r)]=t[r],e),{}):t}function xB(t){return t.split("-").map(e=>e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()).join("-")}function to(t,e){return e?t.then(r=>{setTimeout(()=>{e(null,r)},0)},r=>{setTimeout(()=>{e(r,null)},0)}):t}function u4(t){return t==="OAuth"?"oauth":t[0].toLowerCase()+t.substring(1)}function ro(t){return typeof process.emitWarning!="function"?console.warn(`Stripe: ${t}`):process.emitWarning(t,"Stripe")}function bB(t){let e=typeof t;return(e==="function"||e==="object")&&!!t}function l4(t){let e={},r=(n,i)=>{Object.entries(n).forEach(([s,a])=>{let o=i?`${i}[${s}]`:s;if(bB(a)){if(!(a instanceof Uint8Array)&&!Object.prototype.hasOwnProperty.call(a,"data"))return r(a,o);e[o]=a}else e[o]=String(a)})};return r(t,null),e}function sl(t,e,r){if(!Number.isInteger(e)){if(r!==void 0)return r;throw new Error(`${t} must be an integer`)}return e}function p4(){return typeof process>"u"?{}:{lang_version:process.version,platform:process.platform}}function tl(t){let e=r=>(r.headers.Authorization="Bearer "+t,Promise.resolve());return e._apiKey=t,e}function d4(t){let e=t.reduce((i,s)=>i+s.length,0),r=new Uint8Array(e),n=0;return t.forEach(i=>{r.set(i,n),n+=i.length}),r}function wB(t,e){return this[t]instanceof Date?Math.floor(this[t].getTime()/1e3).toString():e}function f4(t){return JSON.stringify(t,wB)}function rs(t){return t&&t.startsWith("/v2")?"v2":"v1"}function al(t){return Array.isArray(t)?t.join(", "):String(t)}function m4(t){let e=Array.isArray(t)?t[0]:t;return Number(e)}function h4(t){return Object.entries(t).map(([e,r])=>[e,al(r)])}var ol=class t extends Ye{constructor(e){if(super(),!e){if(!globalThis.fetch)throw new Error("fetch() function not provided and is not defined in the global scope. You must provide a fetch implementation.");e=globalThis.fetch}globalThis.AbortController?this._fetchFn=t.makeFetchWithAbortTimeout(e):this._fetchFn=t.makeFetchWithRaceTimeout(e)}static makeFetchWithRaceTimeout(e){return(r,n,i)=>{let s,a=new Promise((u,c)=>{s=setTimeout(()=>{s=null,c(Ye.makeTimeoutError())},i)}),o=e(r,n);return Promise.race([o,a]).finally(()=>{s&&clearTimeout(s)})}}static makeFetchWithAbortTimeout(e){return async(r,n,i)=>{let s=new AbortController,a=setTimeout(()=>{a=null,s.abort(Ye.makeTimeoutError())},i);try{return await e(r,Object.assign(Object.assign({},n),{signal:s.signal}))}catch(o){throw o.name==="AbortError"?Ye.makeTimeoutError():o}finally{a&&clearTimeout(a)}}}getClientName(){return"fetch"}async makeRequest(e,r,n,i,s,a,o,u){let c=o==="http",l=new URL(n,`${c?"http":"https"}://${e}`);l.port=r;let p=i=="POST"||i=="PUT"||i=="PATCH",d=a||(p?"":void 0),m=await this._fetchFn(l.toString(),{method:i,headers:h4(s),body:d},u);return new Ov(m)}},Ov=class t extends Kr{constructor(e){super(e.status,t._transformHeadersToObject(e.headers)),this._res=e}getRawResponse(){return this._res}toStream(e){return e(),this._res.body}toJSON(){return this._res.json()}static _transformHeadersToObject(e){let r={};for(let n of e){if(!Array.isArray(n)||n.length!=2)throw new Error("Response objects produced by the fetch function given to FetchHttpClient do not have an iterable headers map. Response#headers should be an iterable object.");r[n[0]]=n[1]}return r}};var cl=class extends Wr{constructor(e){super(),this.subtleCrypto=e||crypto.subtle}computeHMACSignature(e,r){throw new es("SubtleCryptoProvider cannot be used in a synchronous context.")}async computeHMACSignatureAsync(e,r){let n=new TextEncoder,i=await this.subtleCrypto.importKey("raw",n.encode(r),{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),s=await this.subtleCrypto.sign("hmac",i,n.encode(e)),a=new Uint8Array(s),o=new Array(a.length);for(let u=0;u<a.length;u++)o[u]=Iv[a[u]];return o.join("")}async computeSHA256Async(e){return new Uint8Array(await this.subtleCrypto.digest("SHA-256",e))}},Iv=new Array(256);for(let t=0;t<Iv.length;t++)Iv[t]=t.toString(16).padStart(2,"0");var ul=class{constructor(){this._fetchFn=null,this._agent=null}getUname(){throw new Error("getUname not implemented.")}uuid4(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let r=Math.random()*16|0;return(e==="x"?r:r&3|8).toString(16)})}secureCompare(e,r){if(e.length!==r.length)return!1;let n=e.length,i=0;for(let s=0;s<n;++s)i|=e.charCodeAt(s)^r.charCodeAt(s);return i===0}createEmitter(){throw new Error("createEmitter not implemented.")}tryBufferData(e){throw new Error("tryBufferData not implemented.")}createNodeHttpClient(e){throw new Error("createNodeHttpClient not implemented.")}createFetchHttpClient(e){return new ol(e)}createDefaultHttpClient(){throw new Error("createDefaultHttpClient not implemented.")}createNodeCryptoProvider(){throw new Error("createNodeCryptoProvider not implemented.")}createSubtleCryptoProvider(e){return new cl(e)}createDefaultCryptoProvider(){throw new Error("createDefaultCryptoProvider not implemented.")}};var hl={};bs(hl,{StripeAPIError:()=>ns,StripeAuthenticationError:()=>is,StripeCardError:()=>ll,StripeConnectionError:()=>so,StripeError:()=>Oe,StripeIdempotencyError:()=>pl,StripeInvalidGrantError:()=>dl,StripeInvalidRequestError:()=>no,StripePermissionError:()=>io,StripeRateLimitError:()=>ss,StripeSignatureVerificationError:()=>Zt,StripeUnknownError:()=>fl,TemporarySessionExpiredError:()=>ml,generateV1Error:()=>ao,generateV2Error:()=>Rv});var ao=t=>{switch(t.type){case"card_error":return new ll(t);case"invalid_request_error":return new no(t);case"api_error":return new ns(t);case"authentication_error":return new is(t);case"rate_limit_error":return new ss(t);case"idempotency_error":return new pl(t);case"invalid_grant":return new dl(t);default:return new fl(t)}},Rv=t=>{switch(t.type){case"temporary_session_expired":return new ml(t)}switch(t.code){case"invalid_fields":return new no(t)}return ao(t)},Oe=class extends Error{constructor(e={},r=null){var n;super(e.message),this.type=r||this.constructor.name,this.raw=e,this.rawType=e.type,this.code=e.code,this.doc_url=e.doc_url,this.param=e.param,this.detail=e.detail,this.headers=e.headers,this.requestId=e.requestId,this.statusCode=e.statusCode,this.message=(n=e.message)!==null&&n!==void 0?n:"",this.userMessage=e.user_message,this.charge=e.charge,this.decline_code=e.decline_code,this.payment_intent=e.payment_intent,this.payment_method=e.payment_method,this.payment_method_type=e.payment_method_type,this.setup_intent=e.setup_intent,this.source=e.source}};Oe.generate=ao;var ll=class extends Oe{constructor(e={}){super(e,"StripeCardError")}},no=class extends Oe{constructor(e={}){super(e,"StripeInvalidRequestError")}},ns=class extends Oe{constructor(e={}){super(e,"StripeAPIError")}},is=class extends Oe{constructor(e={}){super(e,"StripeAuthenticationError")}},io=class extends Oe{constructor(e={}){super(e,"StripePermissionError")}},ss=class extends Oe{constructor(e={}){super(e,"StripeRateLimitError")}},so=class extends Oe{constructor(e={}){super(e,"StripeConnectionError")}},Zt=class extends Oe{constructor(e,r,n={}){super(n,"StripeSignatureVerificationError"),this.header=e,this.payload=r}},pl=class extends Oe{constructor(e={}){super(e,"StripeIdempotencyError")}},dl=class extends Oe{constructor(e={}){super(e,"StripeInvalidGrantError")}},fl=class extends Oe{constructor(e={}){super(e,"StripeUnknownError")}},ml=class extends Oe{constructor(e={}){super(e,"TemporarySessionExpiredError")}};var v4=require("child_process"),jv=class extends Oe{},vl=class extends ul{constructor(){super(),this._exec=v4.exec,this._UNAME_CACHE=null}uuid4(){return as.randomUUID?as.randomUUID():super.uuid4()}getUname(){return this._UNAME_CACHE||(this._UNAME_CACHE=new Promise((e,r)=>{try{this._exec("uname -a",(n,i)=>{if(n)return e(null);e(i)})}catch{e(null)}})),this._UNAME_CACHE}secureCompare(e,r){if(!e||!r)throw new Error("secureCompare must receive two arguments");if(e.length!==r.length)return!1;if(as.timingSafeEqual){let n=new TextEncoder,i=n.encode(e),s=n.encode(r);return as.timingSafeEqual(i,s)}return super.secureCompare(e,r)}createEmitter(){return new Nv.EventEmitter}tryBufferData(e){if(!(e.file.data instanceof Nv.EventEmitter))return Promise.resolve(e);let r=[];return new Promise((n,i)=>{e.file.data.on("data",s=>{r.push(s)}).once("end",()=>{let s=Object.assign({},e);s.file.data=d4(r),n(s)}).on("error",s=>{i(new jv({message:"An error occurred while attempting to process the file for upload.",detail:s}))})})}createNodeHttpClient(e){return new eo(e)}createDefaultHttpClient(){return new eo}createNodeCryptoProvider(){return new Yu}createDefaultCryptoProvider(){return this.createNodeCryptoProvider()}};var SB=60,gl=class t{constructor(e,r){this._stripe=e,this._maxBufferedRequestMetric=r}_normalizeStripeContext(e,r){return e?e.toString()||null:r?.toString()||null}_addHeadersDirectlyToObject(e,r){e.requestId=r["request-id"],e.stripeAccount=e.stripeAccount||r["stripe-account"],e.apiVersion=e.apiVersion||r["stripe-version"],e.idempotencyKey=e.idempotencyKey||r["idempotency-key"]}_makeResponseEvent(e,r,n){let i=Date.now(),s=i-e.request_start_time;return il({api_version:n["stripe-version"],account:n["stripe-account"],idempotency_key:n["idempotency-key"],method:e.method,path:e.path,status:r,request_id:this._getRequestId(n),elapsed:s,request_start_time:e.request_start_time,request_end_time:i})}_getRequestId(e){return e["request-id"]}_streamingResponseHandler(e,r,n){return i=>{let s=i.getHeaders(),a=()=>{let u=this._makeResponseEvent(e,i.getStatusCode(),s);this._stripe._emitter.emit("response",u),this._recordRequestMetrics(this._getRequestId(s),u.elapsed,r)},o=i.toStream(a);return this._addHeadersDirectlyToObject(o,s),n(null,o)}}_jsonResponseHandler(e,r,n,i){return s=>{let a=s.getHeaders(),o=this._getRequestId(a),u=s.getStatusCode(),c=this._makeResponseEvent(e,u,a);this._stripe._emitter.emit("response",c),s.toJSON().then(l=>{if(l.error){let p;throw typeof l.error=="string"&&(l.error={type:l.error,message:l.error_description}),l.error.headers=a,l.error.statusCode=u,l.error.requestId=o,u===401?p=new is(l.error):u===403?p=new io(l.error):u===429?p=new ss(l.error):r==="v2"?p=Rv(l.error):p=ao(l.error),p}return l},l=>{throw new ns({message:"Invalid JSON received from the Stripe API",exception:l,requestId:a["request-id"]})}).then(l=>{this._recordRequestMetrics(o,c.elapsed,n);let p=s.getRawResponse();this._addHeadersDirectlyToObject(p,a),Object.defineProperty(l,"lastResponse",{enumerable:!1,writable:!1,value:p}),i(null,l)},l=>i(l,null))}}static _generateConnectionErrorMessage(e){return`An error occurred with our connection to Stripe.${e>0?` Request was retried ${e} times.`:""}`}static _shouldRetry(e,r,n,i){return i&&r===0&&Ye.CONNECTION_CLOSED_ERROR_CODES.includes(i.code)?!0:r>=n?!1:e?e.getHeaders()["stripe-should-retry"]==="false"?!1:e.getHeaders()["stripe-should-retry"]==="true"||e.getStatusCode()===409||e.getStatusCode()>=500:!0}_getSleepTimeInMS(e,r=null){let n=this._stripe.getInitialNetworkRetryDelay(),i=this._stripe.getMaxNetworkRetryDelay(),s=Math.min(n*Math.pow(2,e-1),i);return s*=.5*(1+Math.random()),s=Math.max(n,s),Number.isInteger(r)&&r<=SB&&(s=Math.max(s,r)),s*1e3}_getMaxNetworkRetries(e={}){return e.maxNetworkRetries
0|ozvps-panel  | !==void 0&&Number.isInteger(e.maxNetworkRetries)?e.maxNetworkRetries:this._stripe.getMaxNetworkRetries()}_defaultIdempotencyKey(e,r,n){let i=this._getMaxNetworkRetries(r),s=()=>`stripe-node-retry-${this._stripe._platformFunctions.uuid4()}`;if(n==="v2"){if(e==="POST"||e==="DELETE")return s()}else if(n==="v1"&&e==="POST"&&i>0)return s();return null}_makeHeaders({contentType:e,contentLength:r,apiVersion:n,clientUserAgent:i,method:s,userSuppliedHeaders:a,userSuppliedSettings:o,stripeAccount:u,stripeContext:c,apiMode:l}){let p={Accept:"application/json","Content-Type":e,"User-Agent":this._getUserAgentString(l),"X-Stripe-Client-User-Agent":i,"X-Stripe-Client-Telemetry":this._getTelemetryHeader(),"Stripe-Version":n,"Stripe-Account":u,"Stripe-Context":c,"Idempotency-Key":this._defaultIdempotencyKey(s,o,l)},d=s=="POST"||s=="PUT"||s=="PATCH";return(d||r)&&(d||ro(`${s} method had non-zero contentLength but no payload is expected for this verb`),p["Content-Length"]=r),Object.assign(il(p),c4(a))}_getUserAgentString(e){let r=this._stripe.getConstant("PACKAGE_VERSION"),n=this._stripe._appInfo?this._stripe.getAppInfoAsString():"";return`Stripe/${e} NodeBindings/${r} ${n}`.trim()}_getTelemetryHeader(){if(this._stripe.getTelemetryEnabled()&&this._stripe._prevRequestMetrics.length>0){let e=this._stripe._prevRequestMetrics.shift();return JSON.stringify({last_request_metrics:e})}}_recordRequestMetrics(e,r,n){if(this._stripe.getTelemetryEnabled()&&e)if(this._stripe._prevRequestMetrics.length>this._maxBufferedRequestMetric)ro("Request metrics buffer is full, dropping telemetry message.");else{let i={request_id:e,request_duration_ms:r};n&&n.length>0&&(i.usage=n),this._stripe._prevRequestMetrics.push(i)}}_rawRequest(e,r,n,i,s){return new Promise((o,u)=>{let c;try{let h=e.toUpperCase();if(h!=="POST"&&n&&Object.keys(n).length!==0)throw new Error("rawRequest only supports params on POST requests. Please pass null and add your parameters to path.");let v=[].slice.call([n,i]),w=ts(v),S=h==="POST"?Object.assign({},w):null,E=nl(v),T=E.headers,k=E.authenticator;c={requestMethod:h,requestPath:r,bodyData:S,queryData:{},authenticator:k,headers:T,host:E.host,streaming:!!E.streaming,settings:{},usage:s||["raw_request"]}}catch(h){u(h);return}function l(h,v){h?u(h):o(v)}let{headers:p,settings:d}=c,m=c.authenticator;this._request(c.requestMethod,c.host,r,c.bodyData,m,{headers:p,settings:d,streaming:c.streaming},c.usage,l)})}_request(e,r,n,i,s,a,o=[],u,c=null){var l;let p;s=(l=s??this._stripe._authenticator)!==null&&l!==void 0?l:null;let d=rs(n),m=(w,S,E,T,k)=>setTimeout(w,this._getSleepTimeInMS(T,k),S,E,T+1),h=(w,S,E)=>{let T=a.settings&&a.settings.timeout&&Number.isInteger(a.settings.timeout)&&a.settings.timeout>=0?a.settings.timeout:this._stripe.getApiField("timeout"),k={host:r||this._stripe.getApiField("host"),port:this._stripe.getApiField("port"),path:n,method:e,headers:Object.assign({},S),body:p,protocol:this._stripe.getApiField("protocol")};s(k).then(()=>{let D=this._stripe.getApiField("httpClient").makeRequest(k.host,k.port,k.path,k.method,k.headers,k.body,k.protocol,T),F=Date.now(),I=il({api_version:w,account:al(S["Stripe-Account"]),idempotency_key:al(S["Idempotency-Key"]),method:e,path:n,request_start_time:F}),M=E||0,z=this._getMaxNetworkRetries(a.settings||{});this._stripe._emitter.emit("request",I),D.then(ae=>t._shouldRetry(ae,M,z)?m(h,w,S,M,m4(ae.getHeaders()["retry-after"])):a.streaming&&ae.getStatusCode()<400?this._streamingResponseHandler(I,o,u)(ae):this._jsonResponseHandler(I,d,o,u)(ae)).catch(ae=>{if(t._shouldRetry(null,M,z,ae))return m(h,w,S,M,null);{let Ze=ae.code&&ae.code===Ye.TIMEOUT_ERROR_CODE;return u(new so({message:Ze?`Request aborted due to timeout being reached (${T}ms)`:t._generateConnectionErrorMessage(M),detail:ae}))}})}).catch(D=>{throw new Oe({message:"Unable to authenticate the request",exception:D})})},v=(w,S)=>{if(w)return u(w);p=S,this._stripe.getClientUserAgent(E=>{var T,k,D;let F=this._stripe.getApiField("version"),I=this._makeHeaders({contentType:d=="v2"?"application/json":"application/x-www-form-urlencoded",contentLength:new TextEncoder().encode(p).length,apiVersion:F,clientUserAgent:E,method:e,userSuppliedHeaders:(T=a.headers)!==null&&T!==void 0?T:null,userSuppliedSettings:(k=a.settings)!==null&&k!==void 0?k:{},stripeAccount:(D=a.stripeAccount)!==null&&D!==void 0?D:this._stripe.getApiField("stripeAccount"),stripeContext:this._normalizeStripeContext(a.stripeContext,this._stripe.getApiField("stripeContext")),apiMode:d});h(F,I,0)})};if(c)c(e,i,a.headers,v);else{let w;d=="v2"?w=i?f4(i):"":w=Zr(i||{},d),v(null,w)}}};var yl=class{constructor(e,r,n,i){this.index=0,this.pagePromise=e,this.promiseCache={currentPromise:null},this.requestArgs=r,this.spec=n,this.stripeResource=i}async iterate(e){if(!(e&&e.data&&typeof e.data.length=="number"))throw Error("Unexpected: Stripe API response does not have a well-formed `data` array.");let r=y4(this.requestArgs);if(this.index<e.data.length){let n=r?e.data.length-1-this.index:this.index,i=e.data[n];return this.index+=1,{value:i,done:!1}}else if(e.has_more){this.index=0,this.pagePromise=this.getNextPage(e);let n=await this.pagePromise;return this.iterate(n)}return{done:!0,value:void 0}}getNextPage(e){throw new Error("Unimplemented")}async _next(){return this.iterate(await this.pagePromise)}next(){if(this.promiseCache.currentPromise)return this.promiseCache.currentPromise;let e=(async()=>{let r=await this._next();return this.promiseCache.currentPromise=null,r})();return this.promiseCache.currentPromise=e,e}},Mv=class extends yl{getNextPage(e){let r=y4(this.requestArgs),n=PB(e,r);return this.stripeResource._makeRequest(this.requestArgs,this.spec,{[r?"ending_before":"starting_after"]:n})}},Dv=class extends yl{getNextPage(e){if(!e.next_page)throw Error("Unexpected: Stripe API response does not have a well-formed `next_page` field, but `has_more` was true.");return this.stripeResource._makeRequest(this.requestArgs,this.spec,{page:e.next_page})}},$v=class{constructor(e,r,n,i){this.currentPageIterator=(async()=>(await e).data[Symbol.iterator]())(),this.nextPageUrl=(async()=>(await e).next_page_url||null)(),this.requestArgs=r,this.spec=n,this.stripeResource=i}async turnPage(){let e=await this.nextPageUrl;if(!e)return null;this.spec.fullPath=e;let r=await this.stripeResource._makeRequest([],this.spec,{});return this.nextPageUrl=Promise.resolve(r.next_page_url),this.currentPageIterator=Promise.resolve(r.data[Symbol.iterator]()),this.currentPageIterator}async next(){{let n=(await this.currentPageIterator).next();if(!n.done)return{done:!1,value:n.value}}let e=await this.turnPage();if(!e)return{done:!0,value:void 0};let r=e.next();return r.done?{done:!0,value:void 0}:{done:!1,value:r.value}}},g4=(t,e,r,n)=>{let i=rs(r.fullPath||r.path);return i!=="v2"&&r.methodType==="search"?qv(new Dv(n,e,r,t)):i!=="v2"&&r.methodType==="list"?qv(new Mv(n,e,r,t)):i==="v2"&&r.methodType==="list"?qv(new $v(n,e,r,t)):null},qv=t=>{let e=kB((...i)=>t.next(...i)),r=AB(e),n={autoPagingEach:e,autoPagingToArray:r,next:()=>t.next(),return:()=>({}),[_B()]:()=>n};return n};function _B(){return typeof Symbol<"u"&&Symbol.asyncIterator?Symbol.asyncIterator:"@@asyncIterator"}function TB(t){if(t.length<2)return null;let e=t[1];if(typeof e!="function")throw Error(`The second argument to autoPagingEach, if present, must be a callback function; received ${typeof e}`);return e}function EB(t){if(t.length===0)return;let e=t[0];if(typeof e!="function")throw Error(`The first argument to autoPagingEach, if present, must be a callback function; received ${typeof e}`);if(e.length===2)return e;if(e.length>2)throw Error(`The \`onItem\` callback function passed to autoPagingEach must accept at most two arguments; got ${e}`);return function(n,i){let s=e(n);i(s)}}function PB(t,e){let r=e?0:t.data.length-1,n=t.data[r],i=n&&n.id;if(!i)throw Error("Unexpected: No `id` found on the last item while auto-paging a list.");return i}function kB(t){return function(){let r=[].slice.call(arguments),n=EB(r),i=TB(r);if(r.length>2)throw Error(`autoPagingEach takes up to two arguments; received ${r}`);let s=CB(t,n);return to(s,i)}}function AB(t){return function(r,n){let i=r&&r.limit;if(!i)throw Error("You must pass a `limit` option to autoPagingToArray, e.g., `autoPagingToArray({limit: 1000});`.");if(i>1e4)throw Error("You cannot specify a limit of more than 10,000 items to fetch in `autoPagingToArray`; use `autoPagingEach` to iterate through longer lists.");let s=new Promise((a,o)=>{let u=[];t(c=>{if(u.push(c),u.length>=i)return!1}).then(()=>{a(u)}).catch(o)});return to(s,n)}}function CB(t,e){return new Promise((r,n)=>{function i(s){if(s.done){r();return}let a=s.value;return new Promise(o=>{e(a,o)}).then(o=>o===!1?i({done:!0,value:void 0}):t().then(i))}t().then(i).catch(n)})}function y4(t){let e=[].slice.call(t);return!!ts(e).ending_before}function x4(t){if(t.path!==void 0&&t.fullPath!==void 0)throw new Error(`Method spec specified both a 'path' (${t.path}) and a 'fullPath' (${t.fullPath}).`);return function(...e){let r=typeof e[e.length-1]=="function"&&e.pop();t.urlParams=a4(t.fullPath||this.createResourcePathWithSymbols(t.path||""));let n=to(this._makeRequest(e,t,{}),r);return Object.assign(n,g4(this,e,t,n)),n}}f.extend=o4;f.method=x4;f.MAX_BUFFERED_REQUEST_METRICS=100;function f(t,e){if(this._stripe=t,e)throw new Error("Support for curried url params was dropped in stripe-node v7.0.0. Instead, pass two ids.");this.basePath=rl(this.basePath||t.getApiField("basePath")),this.resourcePath=this.path,this.path=rl(this.path),this.initialize(...arguments)}f.prototype={_stripe:null,path:"",resourcePath:"",basePath:null,initialize(){},requestDataProcessor:null,validateRequest:null,createFullPath(t,e){let r=[this.basePath(e),this.path(e)];if(typeof t=="function"){let n=t(e);n&&r.push(n)}else r.push(t);return this._joinUrlParts(r)},createResourcePathWithSymbols(t){return t?`/${this._joinUrlParts([this.resourcePath,t])}`:`/${this.resourcePath}`},_joinUrlParts(t){return t.join("/").replace(/\/{2,}/g,"/")},_getRequestOpts(t,e,r){var n;let i=(e.method||"GET").toUpperCase(),s=e.usage||[],a=e.urlParams||[],o=e.encode||(I=>I),u=!!e.fullPath,c=rl(u?e.fullPath:e.path||""),l=u?e.fullPath:this.createResourcePathWithSymbols(e.path),p=[].slice.call(t),d=a.reduce((I,M)=>{let z=p.shift();if(typeof z!="string")throw new Error(`Stripe: Argument "${M}" must be a string, but got: ${z} (on API request to \`${i} ${l}\`)`);return I[M]=z,I},{}),m=ts(p),h=o(Object.assign({},m,r)),v=nl(p),w=v.host||e.host,S=!!e.streaming||!!v.streaming;if(p.filter(I=>I!=null).length)throw new Error(`Stripe: Unknown arguments (${p}). Did you mean to pass an options object? See https://github.com/stripe/stripe-node/wiki/Passing-Options. (on API request to ${i} \`${l}\`)`);let E=u?c(d):this.createFullPath(c,d),T=Object.assign(v.headers,e.headers);e.validator&&e.validator(h,{headers:T});let k=e.method==="GET"||e.method==="DELETE";return{requestMethod:i,requestPath:E,bodyData:k?null:h,queryData:k?h:{},authenticator:(n=v.authenticator)!==null&&n!==void 0?n:null,headers:T,host:w??null,streaming:S,settings:v.settings,usage:s}},_makeRequest(t,e,r){return new Promise((n,i)=>{var s;let a;try{a=this._getRequestOpts(t,e,r)}catch(d){i(d);return}function o(d,m){d?i(d):n(e.transformResponseData?e.transformResponseData(m):m)}let u=Object.keys(a.queryData).length===0,c=[a.requestPath,u?"":"?",Zr(a.queryData,rs(a.requestPath))].join(""),{headers:l,settings:p}=a;this._stripe._requestSender._request(a.requestMethod,a.host,c,a.bodyData,a.authenticator,{headers:l,settings:p,streaming:a.streaming},a.usage,o,(s=this.requestDataProcessor)===null||s===void 0?void 0:s.bind(this))})}};var oo=class t{constructor(e=[]){this._segments=[...e]}get segments(){return[...this._segments]}push(e){if(!e)throw new Error("Segment cannot be null or undefined");return new t([...this._segments,e])}pop(){if(this._segments.length===0)throw new Error("Cannot pop from an empty context");return new t(this._segments.slice(0,-1))}toString(){return this._segments.join("/")}static parse(e){return e?new t(e.split("/")):new t([])}};function b4(t){let e={DEFAULT_TOLERANCE:300,signature:null,constructEvent(l,p,d,m,h,v){try{if(!this.signature)throw new Error("ERR: missing signature helper, unable to verify");this.signature.verifyHeader(l,p,d,m||e.DEFAULT_TOLERANCE,h,v)}catch(S){throw S instanceof es&&(S.message+="\nUse `await constructEventAsync(...)` instead of `constructEvent(...)`"),S}return l instanceof Uint8Array?JSON.parse(new TextDecoder("utf8").decode(l)):JSON.parse(l)},async constructEventAsync(l,p,d,m,h,v){if(!this.signature)throw new Error("ERR: missing signature helper, unable to verify");return await this.signature.verifyHeaderAsync(l,p,d,m||e.DEFAULT_TOLERANCE,h,v),l instanceof Uint8Array?JSON.parse(new TextDecoder("utf8").decode(l)):JSON.parse(l)},generateTestHeaderString:function(l){let p=c(l),d=p.signature||p.cryptoProvider.computeHMACSignature(p.payloadString,p.secret);return p.generateHeaderString(d)},generateTestHeaderStringAsync:async function(l){let p=c(l),d=p.signature||await p.cryptoProvider.computeHMACSignatureAsync(p.payloadString,p.secret);return p.generateHeaderString(d)}},r={EXPECTED_SCHEME:"v1",verifyHeader(l,p,d,m,h,v){let{decodedHeader:w,decodedPayload:S,details:E,suspectPayloadType:T}=i(l,p,this.EXPECTED_SCHEME),k=/\s/.test(d);h=h||u();let D=h.computeHMACSignature(n(S,E),d);return s(S,w,E,D,m,T,k,v),!0},async verifyHeaderAsync(l,p,d,m,h,v){let{decodedHeader:w,decodedPayload:S,details:E,suspectPayloadType:T}=i(l,p,this.EXPECTED_SCHEME),k=/\s/.test(d);h=h||u();let D=await h.computeHMACSignatureAsync(n(S,E),d);return s(S,w,E,D,m,T,k,v)}};function n(l,p){return`${p.timestamp}.${l}`}function i(l,p,d){if(!l)throw new Zt(p,l,{message:"No webhook payload was provided."});let m=typeof l!="string"&&!(l instanceof Uint8Array),h=new TextDecoder("utf8"),v=l instanceof Uint8Array?h.decode(l):l;if(Array.isArray(p))throw new Error("Unexpected: An array was passed as a header, which should not be possible for the stripe-signature header.");if(p==null||p=="")throw new Zt(p,l,{message:"No stripe-signature header value was provided."});let w=p instanceof Uint8Array?h.decode(p):p,S=a(w,d);if(!S||S.timestamp===-1)throw new Zt(w,v,{message:"Unable to extract timestamp and signatures from header"});if(!S.signatures.length)throw new Zt(w,v,{message:"No signatures found with expected scheme"});return{decodedPayload:v,decodedHeader:w,details:S,suspectPayloadType:m}}function s(l,p,d,m,h,v,w,S){let E=!!d.signatures.filter(t.secureCompare.bind(t,m)).length,T=`
0|ozvps-panel  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
0|ozvps-panel  | Error: DATABASE_URL environment variable is not set
0|ozvps-panel  |     at Object.<anonymous> (/opt/ozvps-panel/dist/index.cjs:70:43696)
0|ozvps-panel  |     at Module._compile (node:internal/modules/cjs/loader:1521:14)
0|ozvps-panel  |     at Module._extensions..js (node:internal/modules/cjs/loader:1623:10)
0|ozvps-panel  |     at Module.load (node:internal/modules/cjs/loader:1266:32)
0|ozvps-panel  |     at Module._load (node:internal/modules/cjs/loader:1091:12)
0|ozvps-panel  |     at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:164:12)
0|ozvps-panel  |     at node:internal/main/run_main_module:28:49
0|ozvps-panel  | Node.js v20.19.6
^C
root@celebrated-let:/opt/ozvps-panel#
